<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.7.33" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="James Doss-Gollin" />
<meta name="dcterms.date" content="2025-09-12" />

<title>CEVE 543 Fall 2025 Assignment 1 Fuad Hasan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous" data-relocate-top="true"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <div id="quarto-toc-target"></div>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CEVE 543 Fall 2025 Assignment 1 Fuad Hasan</h1>
<p class="subtitle lead">Assignment 1</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>James Doss-Gollin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>

<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#your-analysis" id="toc-your-analysis">Your Analysis</a></li>
  </ul>
</nav>
<section id="your-analysis" class="level2 unnumbered">
<h2 class="unnumbered">Your Analysis</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Data Setup and Station Selection
</div>
</div>
<div class="callout-body-container callout-body">
<section id="loading-required-packages" class="level3" data-number="0.1">
<h3 data-number="0.1"><span class="header-section-number">0.1</span> Loading Required Packages</h3>
<p>First, we need to load all the Julia packages we’ll use in this analysis:</p>
<div id="2" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Core packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Downloads</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">TidierData</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Extremes</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Optim</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ColorSchemes</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">GeoMakie</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Makie.Unitful</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Makie.Dates</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">&quot;DATAFRAMES_ROWS&quot;</span>] <span class="op">=</span> <span class="fl">5</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure plotting backend</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>CairoMakie.<span class="fu">activate!</span>(<span class="kw">type</span> <span class="op">=</span> <span class="st">&quot;svg&quot;</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># utility functions</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">&quot;util.jl&quot;</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>rainfall_conversion <span class="op">=</span> Makie.<span class="fu">UnitfulConversion</span>(u<span class="st">&quot;inch&quot;</span>)</span></code></pre></div>
</div>
</section>
<section id="loading-noaa-precipitation-data" class="level3" data-number="0.2">
<h3 data-number="0.2"><span class="header-section-number">0.2</span> Loading NOAA Precipitation Data</h3>
<p>Like previous labs, we’ll download and read the Texas precipitation data:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode" id="annotated-cell-2"><pre class="sourceCode julia cell-code code-annotation-code"><code class="sourceCode julia"><span id="annotated-cell-2-1"><a href="#annotated-cell-2-1" aria-hidden="true" tabindex="-1"></a>fname <span class="op">=</span> <span class="st">&quot;dur01d_ams_na14v11.txt&quot;</span></span>
<span id="annotated-cell-2-2"><a href="#annotated-cell-2-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&quot;https://hdsc.nws.noaa.gov/pub/hdsc/data/tx/dur01d_ams_na14v11.txt&quot;</span></span>
<span id="annotated-cell-2-3"><a href="#annotated-cell-2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-2-4"><a href="#annotated-cell-2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> !<span class="fu">isfile</span>(fname)</span>
<span id="annotated-cell-2-5"><a href="#annotated-cell-2-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Downloads</span>.<span class="fu">download</span>(url, fname)</span>
<span id="annotated-cell-2-6"><a href="#annotated-cell-2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="annotated-cell-2-7"><a href="#annotated-cell-2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-2-8"><a href="#annotated-cell-2-8" aria-hidden="true" tabindex="-1"></a>stations, rainfall_data <span class="op">=</span> <span class="fu">read_noaa_data</span>(fname)</span>
<span id="annotated-cell-2-9"><a href="#annotated-cell-2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(stations)</span>
<span id="annotated-cell-2-10"><a href="#annotated-cell-2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(rainfall_data)</span></code></pre></div>
<div class="cell-annotation">
<dl>
<dt>Line 4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="4" data-code-annotation="1">Check if data file already exists locally</span>
</dd>
<dt>Line 5</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5" data-code-annotation="2">Download the file if it doesn’t exist</span>
</dd>
<dt>Line 8</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="8" data-code-annotation="3">Read and parse the NOAA precipitation data</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display">
<div><div style = "float: left;"><span>816×7 DataFrame</span></div><div style = "float: right;"><span style = "font-style: italic;">811 rows omitted</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;">
<table class="data-frame caption-top" data-quarto-postprocess="true" style="margin-bottom: 6px;">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stnid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">noaa_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">latitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">years_of_data</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">60-0011</td>
<td style="text-align: left;">CLEAR CK AT BAY AREA BLVD</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.4977</td>
<td style="text-align: right;">-95.1599</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">60-0019</td>
<td style="text-align: left;">TURKEY CK AT FM 1959</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.5845</td>
<td style="text-align: right;">-95.1869</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">60-0022</td>
<td style="text-align: left;">ARMAND BYU AT GENOARED BLF RD</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.6345</td>
<td style="text-align: right;">-95.1123</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="even">
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">815</td>
<td style="text-align: right;">815</td>
<td style="text-align: left;">87-0031</td>
<td style="text-align: left;">SECO CREEK AT MILLER RANCH</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.5731</td>
<td style="text-align: right;">-99.4028</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">816</td>
<td style="text-align: right;">816</td>
<td style="text-align: left;">99-2048</td>
<td style="text-align: left;">COTULLA</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">28.4567</td>
<td style="text-align: right;">-99.2183</td>
<td style="text-align: right;">116</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<div><div style = "float: left;"><span>61925×4 DataFrame</span></div><div style = "float: right;"><span style = "font-style: italic;">61920 rows omitted</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;">
<table class="data-frame caption-top" data-quarto-postprocess="true" style="margin-bottom: 6px;">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stnid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">rainfall</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Dates.Date">Date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Union{Missing, Unitful.Quantity{Float64, 𝐋, Unitful.FreeUnits{(inch,), 𝐋, nothing}}}">Quantity…?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1987-06-11</td>
<td style="text-align: right;">1987</td>
<td style="text-align: right;">6.31 inch</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1988-09-02</td>
<td style="text-align: right;">1988</td>
<td style="text-align: right;">5.46 inch</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1989-08-01</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">11.39 inch</td>
</tr>
<tr class="even">
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">61924</td>
<td style="text-align: right;">816</td>
<td style="text-align: left;">2016-08-20</td>
<td style="text-align: right;">2016</td>
<td style="text-align: right;">3.44 inch</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">61925</td>
<td style="text-align: right;">816</td>
<td style="text-align: left;">2017-09-25</td>
<td style="text-align: right;">2017</td>
<td style="text-align: right;">2.72 inch</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="choosing-your-station--task-1-part-a-select-one-houston-area-for-primary-analysis" class="level3" data-number="0.3">
<h3 data-number="0.3"><span class="header-section-number">0.3</span> Choosing Your Station- Task 1, part a, Select one Houston area for primary analysis</h3>
<p>For GEV analysis, we need sufficient data. Let’s examine stations with longer records:</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode" id="annotated-cell-3"><pre class="sourceCode julia cell-code code-annotation-code"><code class="sourceCode julia"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show stations ordered by data availability</span></span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@chain</span> stations <span class="cf">begin</span></span>
<span id="annotated-cell-3-3"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(<span class="fu">desc</span>(years_of_data))</span>
<span id="annotated-cell-3-4"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@slice_head</span>(n <span class="op">=</span> <span class="fl">10</span>)</span>
<span id="annotated-cell-3-5"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<div class="cell-annotation">
<dl>
<dt>Line 3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="1">Sort stations by years of data in descending order</span>
</dd>
<dt>Line 4</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="2">Select the top 10 stations with most data</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div><div style = "float: left;"><span>10×7 DataFrame</span></div><div style = "float: right;"><span style = "font-style: italic;">5 rows omitted</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;">
<table class="data-frame caption-top" data-quarto-postprocess="true" style="margin-bottom: 6px;">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stnid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">noaa_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">latitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">years_of_data</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">112</td>
<td style="text-align: left;">41-0420</td>
<td style="text-align: left;">AUSTIN</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">30.2682</td>
<td style="text-align: right;">-97.7426</td>
<td style="text-align: right;">169</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">600</td>
<td style="text-align: left;">41-7622</td>
<td style="text-align: left;">RIO GRANDE CITY</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">26.3769</td>
<td style="text-align: right;">-98.8117</td>
<td style="text-align: right;">168</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">771</td>
<td style="text-align: left;">79-0043</td>
<td style="text-align: left;">BROWNSVILLE</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">25.9156</td>
<td style="text-align: right;">-97.4186</td>
<td style="text-align: right;">168</td>
</tr>
<tr class="even">
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">9</td>
<td style="text-align: right;">303</td>
<td style="text-align: left;">41-3265</td>
<td style="text-align: left;">FT GRIFFIN</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">32.9236</td>
<td style="text-align: right;">-99.2225</td>
<td style="text-align: right;">148</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">10</td>
<td style="text-align: right;">779</td>
<td style="text-align: left;">79-0055</td>
<td style="text-align: left;">GALVESTON</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.3048</td>
<td style="text-align: right;">-94.7934</td>
<td style="text-align: right;">146</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Choose YOUR OWN station for analysis. stnid 780 is chosen for assignment 1</strong></p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode" id="annotated-cell-4"><pre class="sourceCode julia cell-code code-annotation-code"><code class="sourceCode julia"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a>my_stnid <span class="op">=</span> <span class="fl">780</span></span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a>my_station <span class="op">=</span> <span class="pp">@chain</span> stations <span class="cf">begin</span></span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(stnid <span class="op">==</span> !!my_stnid)</span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a>    first</span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-8"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract rainfall data for your chosen station</span></span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>my_precip <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(stnid <span class="op">==</span> !!my_stnid)</span>
<span id="annotated-cell-4-11"><a href="#annotated-cell-4-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(date)</span>
<span id="annotated-cell-4-12"><a href="#annotated-cell-4-12" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="annotated-cell-4-13"><a href="#annotated-cell-4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-4-14"><a href="#annotated-cell-4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">&quot;Selected station: </span><span class="sc">$</span>(my_station.noaa_id)<span class="st"> - </span><span class="sc">$</span>(my_station.name)<span class="st">&quot;</span>)</span>
<span id="annotated-cell-4-15"><a href="#annotated-cell-4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">&quot;Years of data: </span><span class="sc">$</span>(my_station.years_of_data)<span class="st">&quot;</span>)</span></code></pre></div>
<div class="cell-annotation">
<dl>
<dt>Line 10</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="10" data-code-annotation="1">Filter rainfall data for your chosen station using station ID</span>
</dd>
<dt>Line 11</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="11" data-code-annotation="2">Sort the data chronologically by date</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Selected station: 79-0056 - HOUSTON WB CITY
Years of data: 129</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Choosing Your Station- Task 1, part b, Extract annual maximum daily precipitation from station data and visualize
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s visualize your chosen station’s rainfall time series:</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb3"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_time_series</span>(station_row, rainfall_df)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size <span class="op">=</span> (<span class="fl">800</span>, <span class="fl">400</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>],</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        ylabel <span class="op">=</span> <span class="st">&quot;Annual Maximum 24-Hour Rainfall [inch]&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">&quot;</span><span class="sc">$</span>(station_row.noaa_id)<span class="st">: </span><span class="sc">$</span>(station_row.name)<span class="st">&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        dim2_conversion <span class="op">=</span> rainfall_conversion)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax, rainfall_df.date, rainfall_df.rainfall, color <span class="op">=</span> <span class="op">:</span>blue, linewidth <span class="op">=</span> <span class="fl">2</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax, rainfall_df.date, rainfall_df.rainfall, markersize <span class="op">=</span> <span class="fl">10</span>, marker <span class="op">=</span> <span class="op">:</span>circle, strokewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="op">:</span>transparent)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_time_series</span>(my_station, my_precip)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-6-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<section id="gev-fitting-multiple-approaches" class="level2" data-number="1">
<h2 data-number="1"><span class="header-section-number">1</span> GEV Fitting: Multiple Approaches</h2>
<section id="choosing-your-station--task-1-part-c-implemnt-mle-using-maximum_likelihood-from-turing.jl-and-benchmark-results-against-extremes.jl-for-validation" class="level3" data-number="1.1">
<h3 data-number="1.1"><span class="header-section-number">1.1</span> Choosing Your Station- Task 1, part c, Implemnt MLE using maximum_likelihood from Turing.jl and benchmark results against Extremes.jl for validation</h3>
<section id="side-note-there-are-different-gev-fit-approach-we-learned-in-lab-3-the-short-note-is-a-mle-maximum-likelihood-estimator-extremes.jl-package-is-used-and-the-function-name-is-gevfit-b-methods-of-moments-with-extremes.jl-function-is-gevfitpwm-c-bayesian-mle-approach-using-turing.jl-function-gevfitbayes-but-we-basically-used-gevfitmle-metod-approach-here-as-wellso-this-part-of-the-ques-says-to-compare-a-mle-vs-cbayesian-mle" class="level4" data-number="1.1.1">
<h4 data-number="1.1.1"><span class="header-section-number">1.1.1</span> side note: There are different GEV fit approach we learned in lab 3, the short note is, (a) MLE: Maximum likelihood estimator, Extremes.jl package is used and the function name is gevfit (b) Methods of moments with Extremes.jl, function is gevfitpwm (c) bayesian MLE approach using Turing.jl; function gevfitbayes; but we basically used gevfit(MLE metod approach) here as well…so this part of the ques says to compare (a) MLE vs (c)bayesian MLE</h4>
</section>
</section>
<section id="mle-with-extremes.jl" class="level3" data-number="1.2">
<h3 data-number="1.2"><span class="header-section-number">1.2</span> MLE with Extremes.jl</h3>
<p>First, let’s fit a GEV distribution using maximum likelihood estimation (MLE) with <a href="https://jojal5.github.io/Extremes.jl/stable/"><code>Extremes.jl</code></a>:</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode" id="annotated-cell-7"><pre class="sourceCode julia cell-code code-annotation-code"><code class="sourceCode julia"><span id="annotated-cell-7-1"><a href="#annotated-cell-7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract clean data for fitting</span></span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">skipmissing</span>(<span class="fu">ustrip</span>.(u<span class="st">&quot;inch&quot;</span>, my_precip.rainfall)))</span>
<span id="annotated-cell-7-3"><a href="#annotated-cell-7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit GEV using maximum likelihood estimation (MLE)</span></span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5" aria-hidden="true" tabindex="-1"></a>extremes_fit <span class="op">=</span> <span class="fu">gevfit</span>(y)</span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract parameters </span></span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8" aria-hidden="true" tabindex="-1"></a>μ_extremes <span class="op">=</span> <span class="fu">location</span>(extremes_fit)[<span class="fl">1</span>]</span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9" aria-hidden="true" tabindex="-1"></a>σ_extremes <span class="op">=</span> <span class="fu">scale</span>(extremes_fit)[<span class="fl">1</span>]</span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10" aria-hidden="true" tabindex="-1"></a>ξ_extremes <span class="op">=</span> <span class="fu">shape</span>(extremes_fit)[<span class="fl">1</span>]</span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-12"><a href="#annotated-cell-7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display parameters in a DataFrame</span></span>
<span id="annotated-cell-7-13"><a href="#annotated-cell-7-13" aria-hidden="true" tabindex="-1"></a>params_extremes <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="annotated-cell-7-14"><a href="#annotated-cell-7-14" aria-hidden="true" tabindex="-1"></a>    Parameter <span class="op">=</span> [<span class="st">&quot;Location (μ)&quot;</span>, <span class="st">&quot;Scale (σ)&quot;</span>, <span class="st">&quot;Shape (ξ)&quot;</span>],</span>
<span id="annotated-cell-7-15"><a href="#annotated-cell-7-15" aria-hidden="true" tabindex="-1"></a>    Value <span class="op">=</span> [<span class="fu">round</span>(μ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(σ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(ξ_extremes, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">&quot;Extremes.jl GEV parameters:&quot;</span>)</span>
<span id="annotated-cell-7-18"><a href="#annotated-cell-7-18" aria-hidden="true" tabindex="-1"></a>params_extremes</span>
<span id="annotated-cell-7-19"><a href="#annotated-cell-7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-7-20"><a href="#annotated-cell-7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create distribution object for analysis</span></span>
<span id="annotated-cell-7-21"><a href="#annotated-cell-7-21" aria-hidden="true" tabindex="-1"></a>extremes_dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_extremes, σ_extremes, ξ_extremes)</span></code></pre></div>
<div class="cell-annotation">
<dl>
<dt>Line 2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="2" data-code-annotation="1">Convert rainfall data to plain numbers, removing units and missing values</span>
</dd>
<dt>Line 5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="5" data-code-annotation="2">Fit GEV distribution using maximum likelihood estimation (MLE), part c task 1</span>
</dd>
<dt>Line 8</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="8" data-code-annotation="3">Extract location parameter (μ) from the fitted model</span>
</dd>
<dt>Line 9</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="9" data-code-annotation="4">Extract scale parameter (σ) from the fitted model</span>
</dd>
<dt>Line 10</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="10" data-code-annotation="5">Extract shape parameter (ξ) from the fitted model</span>
</dd>
<dt>Line 21</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="21" data-code-annotation="6">Create a distribution object for further analysis and plotting</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Extremes.jl GEV parameters:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Distributions.GeneralizedExtremeValue{Float64}(μ=3.2770237171577272, σ=1.190348323354834, ξ=0.2257264067321968)</code></pre>
</div>
</div>
</section>
<section id="method-of-moments-with-extremes.jl" class="level3" data-number="1.3">
<h3 data-number="1.3"><span class="header-section-number">1.3</span> Method-of-Moments with Extremes.jl</h3>
<p>Now let’s try the method-of-moments approach using probability-weighted moments (PWM): this was not asked in he question but say we computed it</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode" id="annotated-cell-8"><pre class="sourceCode julia cell-code code-annotation-code"><code class="sourceCode julia"><span id="annotated-cell-8-1"><a href="#annotated-cell-8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit GEV using probability-weighted moments (method-of-moments)</span></span>
<span id="annotated-cell-8-2"><a href="#annotated-cell-8-2" aria-hidden="true" tabindex="-1"></a>extremes_pwm_fit <span class="op">=</span> <span class="fu">gevfitpwm</span>(y)</span>
<span id="annotated-cell-8-3"><a href="#annotated-cell-8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-8-4"><a href="#annotated-cell-8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract parameters</span></span>
<span id="annotated-cell-8-5"><a href="#annotated-cell-8-5" aria-hidden="true" tabindex="-1"></a>μ_extremes_pwm <span class="op">=</span> <span class="fu">location</span>(extremes_pwm_fit)[<span class="fl">1</span>]</span>
<span id="annotated-cell-8-6"><a href="#annotated-cell-8-6" aria-hidden="true" tabindex="-1"></a>σ_extremes_pwm <span class="op">=</span> <span class="fu">scale</span>(extremes_pwm_fit)[<span class="fl">1</span>]</span>
<span id="annotated-cell-8-7"><a href="#annotated-cell-8-7" aria-hidden="true" tabindex="-1"></a>ξ_extremes_pwm <span class="op">=</span> <span class="fu">shape</span>(extremes_pwm_fit)[<span class="fl">1</span>]</span>
<span id="annotated-cell-8-8"><a href="#annotated-cell-8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-8-9"><a href="#annotated-cell-8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Display parameters in a DataFrame</span></span>
<span id="annotated-cell-8-10"><a href="#annotated-cell-8-10" aria-hidden="true" tabindex="-1"></a>params_extremes_pwm <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="annotated-cell-8-11"><a href="#annotated-cell-8-11" aria-hidden="true" tabindex="-1"></a>    Parameter <span class="op">=</span> [<span class="st">&quot;Location (μ)&quot;</span>, <span class="st">&quot;Scale (σ)&quot;</span>, <span class="st">&quot;Shape (ξ)&quot;</span>],</span>
<span id="annotated-cell-8-12"><a href="#annotated-cell-8-12" aria-hidden="true" tabindex="-1"></a>    Value <span class="op">=</span> [<span class="fu">round</span>(μ_extremes_pwm, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(σ_extremes_pwm, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(ξ_extremes_pwm, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="annotated-cell-8-13"><a href="#annotated-cell-8-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-8-14"><a href="#annotated-cell-8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">&quot;Extremes.jl PWM parameters:&quot;</span>)</span>
<span id="annotated-cell-8-15"><a href="#annotated-cell-8-15" aria-hidden="true" tabindex="-1"></a>params_extremes_pwm</span>
<span id="annotated-cell-8-16"><a href="#annotated-cell-8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-8-17"><a href="#annotated-cell-8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create distribution object</span></span>
<span id="annotated-cell-8-18"><a href="#annotated-cell-8-18" aria-hidden="true" tabindex="-1"></a>extremes_pwm_dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_extremes_pwm, σ_extremes_pwm, ξ_extremes_pwm)</span></code></pre></div>
<div class="cell-annotation">
<dl>
<dt>Line 2</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="2" data-code-annotation="1">Fit GEV distribution using probability-weighted moments (PWM) method</span>
</dd>
<dt>Line 5</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="5" data-code-annotation="2">Extract location parameter (μ) from the PWM fitted model</span>
</dd>
<dt>Line 6</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="6" data-code-annotation="3">Extract scale parameter (σ) from the PWM fitted model</span>
</dd>
<dt>Line 7</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="7" data-code-annotation="4">Extract shape parameter (ξ) from the PWM fitted model</span>
</dd>
<dt>Line 18</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="18" data-code-annotation="5">Create distribution object for PWM approach</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Extremes.jl PWM parameters:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Distributions.GeneralizedExtremeValue{Float64}(μ=3.268028474716475, σ=1.1842500849040243, ξ=0.2281780167421246)</code></pre>
</div>
</div>
</section>
<section id="bayesian-approach-with-turing.jl-for-task-c-in-part-1" class="level3" data-number="1.4">
<h3 data-number="1.4"><span class="header-section-number">1.4</span> Bayesian Approach with Turing.jl for task c in part 1</h3>
<p>Now let’s implement a Bayesian approach using Turing.jl with wide priors:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode" id="annotated-cell-9"><pre class="sourceCode julia cell-code code-annotation-code"><code class="sourceCode julia"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Bayesian GEV model</span></span>
<span id="annotated-cell-9-2"><a href="#annotated-cell-9-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">gev_model</span>(y)</span>
<span id="annotated-cell-9-3"><a href="#annotated-cell-9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Priors informed by data characteristics</span></span>
<span id="annotated-cell-9-4"><a href="#annotated-cell-9-4" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">10</span>)</span>
<span id="annotated-cell-9-5"><a href="#annotated-cell-9-5" aria-hidden="true" tabindex="-1"></a>    log_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">10</span>)</span>
<span id="annotated-cell-9-6"><a href="#annotated-cell-9-6" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.25</span>)</span>
<span id="annotated-cell-9-7"><a href="#annotated-cell-9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-8"><a href="#annotated-cell-9-8" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>(log_σ)</span>
<span id="annotated-cell-9-9"><a href="#annotated-cell-9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-10"><a href="#annotated-cell-9-10" aria-hidden="true" tabindex="-1"></a>    y <span class="op">.~</span> <span class="fu">GeneralizedExtremeValue</span>(μ, σ, ξ)</span>
<span id="annotated-cell-9-11"><a href="#annotated-cell-9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="annotated-cell-9-12"><a href="#annotated-cell-9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-13"><a href="#annotated-cell-9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model using MLE</span></span>
<span id="annotated-cell-9-14"><a href="#annotated-cell-9-14" aria-hidden="true" tabindex="-1"></a>turing_fit <span class="op">=</span> <span class="fu">maximum_likelihood</span>(<span class="fu">gev_model</span>(y), <span class="fu">NelderMead</span>(); initial_params <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">1.0</span>, <span class="fl">0.0</span>])</span>
<span id="annotated-cell-9-15"><a href="#annotated-cell-9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-16"><a href="#annotated-cell-9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract parameters</span></span>
<span id="annotated-cell-9-17"><a href="#annotated-cell-9-17" aria-hidden="true" tabindex="-1"></a>μ_turing <span class="op">=</span> turing_fit.values[<span class="op">:</span>μ]</span>
<span id="annotated-cell-9-18"><a href="#annotated-cell-9-18" aria-hidden="true" tabindex="-1"></a>σ_turing <span class="op">=</span> <span class="fu">exp</span>(turing_fit.values[<span class="op">:</span>log_σ])</span>
<span id="annotated-cell-9-19"><a href="#annotated-cell-9-19" aria-hidden="true" tabindex="-1"></a>ξ_turing <span class="op">=</span> turing_fit.values[<span class="op">:</span>ξ]</span>
<span id="annotated-cell-9-20"><a href="#annotated-cell-9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-21"><a href="#annotated-cell-9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display parameters in a DataFrame</span></span>
<span id="annotated-cell-9-22"><a href="#annotated-cell-9-22" aria-hidden="true" tabindex="-1"></a>params_turing <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="annotated-cell-9-23"><a href="#annotated-cell-9-23" aria-hidden="true" tabindex="-1"></a>    Parameter <span class="op">=</span> [<span class="st">&quot;Location (μ)&quot;</span>, <span class="st">&quot;Scale (σ)&quot;</span>, <span class="st">&quot;Shape (ξ)&quot;</span>],</span>
<span id="annotated-cell-9-24"><a href="#annotated-cell-9-24" aria-hidden="true" tabindex="-1"></a>    Value <span class="op">=</span> [<span class="fu">round</span>(μ_turing, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(σ_turing, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(ξ_turing, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="annotated-cell-9-25"><a href="#annotated-cell-9-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-9-26"><a href="#annotated-cell-9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">&quot;Turing.jl GEV parameters (MLE):&quot;</span>)</span>
<span id="annotated-cell-9-27"><a href="#annotated-cell-9-27" aria-hidden="true" tabindex="-1"></a>params_turing</span>
<span id="annotated-cell-9-28"><a href="#annotated-cell-9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-9-29"><a href="#annotated-cell-9-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create distribution object</span></span>
<span id="annotated-cell-9-30"><a href="#annotated-cell-9-30" aria-hidden="true" tabindex="-1"></a>turing_dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_turing, σ_turing, ξ_turing)</span></code></pre></div>
<div class="cell-annotation">
<dl>
<dt>Line 4</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="4" data-code-annotation="1">Location parameter with wide prior</span>
</dd>
<dt>Line 5</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="5" data-code-annotation="2">Log-scale parameter with wide prior (ensures positive scale)</span>
</dd>
<dt>Line 6</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="6" data-code-annotation="3">Shape parameter with conservative prior around zero</span>
</dd>
<dt>Line 8</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="8" data-code-annotation="4">Transform to positive scale parameter</span>
</dd>
<dt>Line 10</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="10" data-code-annotation="5">Vectorized likelihood for the GEV distribution</span>
</dd>
<dt>Line 14</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="14" data-code-annotation="6">Maximum likelihood estimation using updated Turing.jl syntax per <a href="https://turinglang.org/docs/usage/mode-estimation/#controlling-the-optimisation-process">docs</a></span>
</dd>
<dt>Line 17</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="17" data-code-annotation="7">Extract location parameter</span>
</dd>
<dt>Line 18</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="18" data-code-annotation="8">Extract and transform scale parameter</span>
</dd>
<dt>Line 19</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="19" data-code-annotation="9">Extract shape parameter</span>
</dd>
<dt>Line 30</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="30" data-code-annotation="10">Create distribution object for analysis</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Turing.jl GEV parameters (MLE):</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Distributions.GeneralizedExtremeValue{Float64}(μ=3.277019149621373, σ=1.1903425017998241, ξ=0.2257274323787416)</code></pre>
</div>
</div>
</section>
<section id="comparing-all-three-methods" class="level3" data-number="1.5">
<h3 data-number="1.5"><span class="header-section-number">1.5</span> Comparing All Three Methods</h3>
<p>This part is Not required for the assignment 1, but let’s compare</p>
<div id="18" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb10"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare parameters</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>params_comparison <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    Method <span class="op">=</span> [<span class="st">&quot;Extremes MLE&quot;</span>, <span class="st">&quot;Extremes PWM&quot;</span>, <span class="st">&quot;Turing MLE&quot;</span>],</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">=</span> [<span class="fu">round</span>(μ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(μ_extremes_pwm, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(μ_turing, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> [<span class="fu">round</span>(σ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(σ_extremes_pwm, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(σ_turing, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">=</span> [<span class="fu">round</span>(ξ_extremes, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(ξ_extremes_pwm, digits <span class="op">=</span> <span class="fl">3</span>), <span class="fu">round</span>(ξ_turing, digits <span class="op">=</span> <span class="fl">3</span>)],</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>params_comparison</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare return levels</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>return_periods <span class="op">=</span> [<span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>]</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>return_levels_comparison <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    T_years <span class="op">=</span> return_periods,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    Extremes_MLE <span class="op">=</span> [<span class="fu">round</span>(<span class="fu">quantile</span>(extremes_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T), digits <span class="op">=</span> <span class="fl">2</span>) for T <span class="kw">in</span> return_periods],</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    Extremes_PWM <span class="op">=</span> [<span class="fu">round</span>(<span class="fu">quantile</span>(extremes_pwm_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T), digits <span class="op">=</span> <span class="fl">2</span>) for T <span class="kw">in</span> return_periods],</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    Turing_MLE <span class="op">=</span> [<span class="fu">round</span>(<span class="fu">quantile</span>(turing_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T), digits <span class="op">=</span> <span class="fl">2</span>) for T <span class="kw">in</span> return_periods],</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>return_levels_comparison</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div><div style = "float: left;"><span>5×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;">
<table class="data-frame caption-top" data-quarto-postprocess="true" style="margin-bottom: 6px;">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">T_years</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Extremes_MLE</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Extremes_PWM</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Turing_MLE</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">5.39</td>
<td style="text-align: right;">5.4</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">6.77</td>
<td style="text-align: right;">6.75</td>
<td style="text-align: right;">6.77</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">8.86</td>
<td style="text-align: right;">8.85</td>
<td style="text-align: right;">8.86</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">10.73</td>
<td style="text-align: right;">10.72</td>
<td style="text-align: right;">10.73</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">12.9</td>
<td style="text-align: right;">12.9</td>
<td style="text-align: right;">12.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now let’s visualize all three fits together:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb11"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lab_dir <span class="op">=</span> <span class="fu">dirname</span>(<span class="st">&quot;D:</span><span class="sc">\\</span><span class="st">FALL 2025</span><span class="sc">\\</span><span class="st">CEVE 543</span><span class="sc">\\</span><span class="st">assignment</span><span class="sc">\\</span><span class="st">prblmset1&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(lab_dir)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>([<span class="st">&quot;Optimization&quot;</span>, <span class="st">&quot;Optim&quot;</span>, <span class="st">&quot;OptimizationOptimJL&quot;</span>])</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">precompile</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">instantiate</span>() <span class="co"># uncomment this the first time you run the lab to install packages, then comment it back</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">Pkg;</span> Pkg.add(&quot;Turing&quot;)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ArviZ</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">NCDatasets</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">OptimizationOptimJL</span>: NelderMead</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>CairoMakie.<span class="fu">activate!</span>(<span class="kw">type</span><span class="op">=</span><span class="st">&quot;svg&quot;</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Downloads</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">&quot;DATAFRAMES_ROWS&quot;</span>] <span class="op">=</span> <span class="fl">5</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">TidierData</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">&quot;util.jl&quot;</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="fu">MersenneTwister</span>(<span class="fl">543</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">  Activating</span> project at `D:\FALL 2025\CEVE 543\assignment`
<span class="ansi-green-fg ansi-bold">   Resolving</span> package versions...
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\Project.toml`
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\Manifest.toml`
<span class="ansi-green-fg ansi-bold">   Resolving</span> package versions...
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\Project.toml`
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\Manifest.toml`
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_parts :: Union{Tuple{Int64, Vararg{Any, 6}}, Tuple{Int64, Any, Any, Any, Any, Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_parts :: Union{Tuple{Int64, Vararg{Any, 7}}, Tuple{Int64, Any, Any, Any, Any, Any, Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_header :: Union{Tuple{AbstractString, Int64}, Tuple{AbstractString, Int64, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_rainfall_data :: Tuple{Vector{&lt;:AbstractString}, Any, Int64}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.read_noaa_data :: Tuple{String}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.test_read_noaa_data :: Tuple{}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.calc_distance :: NTuple{4, Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.weibull_plotting_positions :: Tuple{Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.find_nearest_stations :: Union{Tuple{Any, Any}, Tuple{Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.create_return_period_range :: Union{Tuple{}, Tuple{Any}, Tuple{Any, Any}, Tuple{Any, Any, Any}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>MersenneTwister(543)</code></pre>
</div>
</div>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb13"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">### task 1, part D: Implement Bayesian GEV inference using MCMC with Turing.jl; specify and justify physically-informed priors for location, scale, and shape parameters based on Houston climate knowledge (see Lab 4 for multiple approaches - pick and justify one)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">### lab 4, part 2: Iterative prior development</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">gev_model</span>(y)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">4.0</span>, <span class="fl">1.5</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    log_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>(log_σ)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ, σ, ξ)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">length</span>(y) <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(y)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            y[i] <span class="op">~</span> dist</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>gev_model (generic function with 2 methods)</code></pre>
</div>
</div>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb15"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">load_or_sample</span>(fname, model; overwrite<span class="op">=</span><span class="cn">false</span>, n_chains<span class="op">=</span><span class="fl">4</span>, samples_per_chain<span class="op">=</span><span class="fl">2000</span>, sampler<span class="op">=</span><span class="fu">NUTS</span>(), threading<span class="op">=</span><span class="fu">MCMCThreads</span>(), rng<span class="op">=</span>rng)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    idata <span class="op">=</span> <span class="cf">try</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@assert</span> !overwrite <span class="st">&quot;Reading from cache disabled by overwrite=true&quot;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        idata <span class="op">=</span> ArviZ.<span class="fu">from_netcdf</span>(fname)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@info</span> <span class="st">&quot;Loaded cached prior samples from </span><span class="sc">$</span>fname<span class="st">&quot;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> idata</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        chains <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>            model,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>            threading,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">Int</span>(<span class="fu">ceil</span>(samples_per_chain <span class="op">*</span> n_chains)),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>            n_chains, <span class="co"># number of chains</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>            verbose<span class="op">=</span><span class="cn">false</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        idata <span class="op">=</span> ArviZ.<span class="fu">from_mcmcchains</span>(chains)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        ArviZ.<span class="fu">to_netcdf</span>(idata, fname)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@info</span> <span class="st">&quot;Sampled and cached prior samples to </span><span class="sc">$</span>fname<span class="st">&quot;</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> idata</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>load_or_sample (generic function with 1 method)</code></pre>
</div>
</div>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb17"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>prior_idata_v1 <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">&quot;prior_v1.nc&quot;</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> <span class="fu">gev_model</span>([])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">true</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">load_or_sample</span>(fname, model; overwrite<span class="op">=</span>overwrite)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>prior_GEVs_v1 <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(prior_idata_v1.posterior.μ, <span class="fu">exp</span>.(prior_idata_v1.posterior.log_σ), prior_idata_v1.posterior.ξ))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Only a single thread available: MCMC chains are not sampled in parallel
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ AbstractMCMC C:\Users\Owner\.julia\packages\AbstractMCMC\nQLlh\src\sample.jl:410</span>
<span class="ansi-green-fg">Sampling (1 thread)   0%|█                              |  ETA: N/A</span>
<span class="ansi-green-fg">Sampling (1 thread)   0%|█                              |  ETA: 0:16:11</span>
<span class="ansi-green-fg">Sampling (1 thread)   1%|█                              |  ETA: 0:08:05</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:05:22</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:04:01</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:03:14</span>
<span class="ansi-green-fg">Sampling (1 thread)   3%|█                              |  ETA: 0:02:43</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:02:19</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:02:01</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:01:47</span>
<span class="ansi-green-fg">Sampling (1 thread)   5%|██                             |  ETA: 0:01:36</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|██                             |  ETA: 0:01:27</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|██                             |  ETA: 0:01:19</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|███                            |  ETA: 0:01:13</span>
<span class="ansi-green-fg">Sampling (1 thread)   7%|███                            |  ETA: 0:01:07</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:01:03</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:00:58</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:00:55</span>
<span class="ansi-green-fg">Sampling (1 thread)   9%|███                            |  ETA: 0:00:52</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|███                            |  ETA: 0:00:49</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|████                           |  ETA: 0:00:46</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|████                           |  ETA: 0:00:44</span>
<span class="ansi-green-fg">Sampling (1 thread)  11%|████                           |  ETA: 0:00:41</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:39</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:38</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:36</span>
<span class="ansi-green-fg">Sampling (1 thread)  13%|█████                          |  ETA: 0:00:34</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:33</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:32</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:31</span>
<span class="ansi-green-fg">Sampling (1 thread)  15%|█████                          |  ETA: 0:00:29</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|█████                          |  ETA: 0:00:28</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|█████                          |  ETA: 0:00:27</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|██████                         |  ETA: 0:00:26</span>
<span class="ansi-green-fg">Sampling (1 thread)  17%|██████                         |  ETA: 0:00:26</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:25</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:24</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:23</span>
<span class="ansi-green-fg">Sampling (1 thread)  19%|██████                         |  ETA: 0:00:22</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:22</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:21</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:20</span>
<span class="ansi-green-fg">Sampling (1 thread)  21%|███████                        |  ETA: 0:00:20</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:19</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:19</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:18</span>
<span class="ansi-green-fg">Sampling (1 thread)  23%|████████                       |  ETA: 0:00:18</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:17</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:17</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:20</span>
<span class="ansi-green-fg">Sampling (1 thread)  25%|████████                       |  ETA: 0:00:20</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|████████                       |  ETA: 0:00:19</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|█████████                      |  ETA: 0:00:19</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|█████████                      |  ETA: 0:00:18</span>
<span class="ansi-green-fg">Sampling (1 thread)  27%|█████████                      |  ETA: 0:00:18</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:18</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:17</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:17</span>
<span class="ansi-green-fg">Sampling (1 thread)  29%|█████████                      |  ETA: 0:00:16</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:16</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:16</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:15</span>
<span class="ansi-green-fg">Sampling (1 thread)  31%|██████████                     |  ETA: 0:00:15</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|██████████                     |  ETA: 0:00:15</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|██████████                     |  ETA: 0:00:14</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|███████████                    |  ETA: 0:00:14</span>
<span class="ansi-green-fg">Sampling (1 thread)  33%|███████████                    |  ETA: 0:00:14</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  35%|███████████                    |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  37%|████████████                   |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  39%|█████████████                  |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  41%|█████████████                  |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|█████████████                  |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|██████████████                 |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|██████████████                 |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  43%|██████████████                 |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  45%|██████████████                 |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  47%|███████████████                |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|███████████████                |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|███████████████                |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|████████████████               |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  49%|████████████████               |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  51%|████████████████               |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|████████████████               |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|█████████████████              |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|█████████████████              |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  53%|█████████████████              |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  54%|█████████████████              |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  54%|█████████████████              |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  55%|█████████████████              |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  55%|██████████████████             |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  57%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  57%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  58%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  58%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  59%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  61%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  63%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  65%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  67%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  69%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  71%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  73%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|████████████████████████       |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  75%|████████████████████████       |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  77%|████████████████████████       |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  79%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  81%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  83%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|██████████████████████████     |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  85%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  87%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  89%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  91%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  93%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  95%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  97%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  99%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread) 100%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread) 100%|███████████████████████████████| Time: 0:00:07</span>
<span class="ansi-bright-black-fg">Sampling (1 thread) 100%|███████████████████████████████| Time: 0:00:08</span>
<span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Sampled and cached prior samples to D:\FALL 2025\CEVE 543\assignment\prior_v1.nc
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>32000-element Vector{GeneralizedExtremeValue{Float64}}:
 Distributions.GeneralizedExtremeValue{Float64}(μ=1.4019821874419813, σ=1.5633084462528826, ξ=0.23103768398145547)
 Distributions.GeneralizedExtremeValue{Float64}(μ=5.913751485943754, σ=1.7413795280738866, ξ=0.1048418695549837)
 Distributions.GeneralizedExtremeValue{Float64}(μ=4.444057872970431, σ=1.9939871794202981, ξ=0.25845969346178427)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.993865776099194, σ=1.310968922438582, ξ=-0.08084862022014877)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.993865776099194, σ=1.310968922438582, ξ=-0.08084862022014877)
 Distributions.GeneralizedExtremeValue{Float64}(μ=6.0464387419984496, σ=1.5052667836647526, ξ=0.3108946342085578)
 Distributions.GeneralizedExtremeValue{Float64}(μ=5.8543015174733295, σ=1.8692088646890326, ξ=0.022092462600977025)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.8591426918339606, σ=1.629707988100022, ξ=0.1299015465621372)
 Distributions.GeneralizedExtremeValue{Float64}(μ=5.727038445490792, σ=2.253546592819908, ξ=0.0697909138244906)
 Distributions.GeneralizedExtremeValue{Float64}(μ=2.064375237960177, σ=1.5007811305932273, ξ=0.2012833909953048)
 ⋮
 Distributions.GeneralizedExtremeValue{Float64}(μ=4.822656682024173, σ=1.1447992778861618, ξ=0.053996101923635104)
 Distributions.GeneralizedExtremeValue{Float64}(μ=2.9885399001418604, σ=2.12758062871625, ξ=0.09762858192854625)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.880823031311745, σ=0.9436628105659727, ξ=0.03274977238596276)
 Distributions.GeneralizedExtremeValue{Float64}(μ=2.6247026338510264, σ=1.8181866914934945, ξ=-0.04118036772524741)
 Distributions.GeneralizedExtremeValue{Float64}(μ=5.487669157212406, σ=1.677687667927262, ξ=0.20562801597806946)
 Distributions.GeneralizedExtremeValue{Float64}(μ=5.487669157212406, σ=1.677687667927262, ξ=0.20562801597806946)
 Distributions.GeneralizedExtremeValue{Float64}(μ=4.382532759742311, σ=3.2486442457129012, ξ=0.2635219932389523)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.843639196112149, σ=0.8199269864445392, ξ=-0.05180252583652355)
 Distributions.GeneralizedExtremeValue{Float64}(μ=4.473238612243, σ=3.6173474713720792, ξ=0.13795174210988406)</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb19"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">###plot for very bad estimate prior on parameters</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">raw&quot;D:\FALL 2025\CEVE 543\assignment\prblmset1\New folder\util.jl&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">600</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Prior v1 Predictive Distribution&quot;</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>[<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>])</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">500</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">rand</span>(<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(prior_GEVs_v1), <span class="fl">250</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        gev <span class="op">=</span> prior_GEVs_v1[i]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_return_level_curve!</span>(ax, gev, rts; color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.125</span>))</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylims!</span>(ax, <span class="fl">0</span>, <span class="fl">75</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_parts :: Union{Tuple{Int64, Vararg{Any, 6}}, Tuple{Int64, Any, Any, Any, Any, Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_parts :: Union{Tuple{Int64, Vararg{Any, 7}}, Tuple{Int64, Any, Any, Any, Any, Any, Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_header :: Union{Tuple{AbstractString, Int64}, Tuple{AbstractString, Int64, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_rainfall_data :: Tuple{Vector{&lt;:AbstractString}, Any, Int64}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.read_noaa_data :: Tuple{String}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.test_read_noaa_data :: Tuple{}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.calc_distance :: NTuple{4, Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.weibull_plotting_positions :: Tuple{Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.find_nearest_stations :: Union{Tuple{Any, Any}, Tuple{Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-16-output-2.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb20"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">###priors on return level</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>return_level_priors <span class="op">=</span> [</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ReturnLevelPrior</span>(<span class="fl">2</span>, <span class="fl">3.0</span>, <span class="fl">1.5</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ReturnLevelPrior</span>(<span class="fl">10</span>, <span class="fl">8.0</span>, <span class="fl">4</span>),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ReturnLevelPrior</span>(<span class="fl">50</span>, <span class="fl">12.0</span>, <span class="fl">6</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ReturnLevelPrior</span>(<span class="fl">100</span>, <span class="fl">16</span>, <span class="fl">8</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>4-element Vector{ReturnLevelPrior}:
 ReturnLevelPrior(0.5, Distributions.InverseGamma{Float64}(
invd: Distributions.Gamma{Float64}(α=6.0, θ=0.06666666666666667)
θ: 15.0
)
)
 ReturnLevelPrior(0.9, Distributions.InverseGamma{Float64}(
invd: Distributions.Gamma{Float64}(α=6.0, θ=0.025)
θ: 40.0
)
)
 ReturnLevelPrior(0.98, Distributions.InverseGamma{Float64}(
invd: Distributions.Gamma{Float64}(α=6.0, θ=0.016666666666666666)
θ: 60.0
)
)
 ReturnLevelPrior(0.99, Distributions.InverseGamma{Float64}(
invd: Distributions.Gamma{Float64}(α=6.0, θ=0.0125)
θ: 80.0
)
)</code></pre>
</div>
</div>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb22"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">gev_model_quantile_priors</span>(y; return_level_priors<span class="op">=</span>[])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">4.0</span>, <span class="fl">1.5</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    log_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>(log_σ)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ, σ, ξ)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply return level constraints</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> prior <span class="kw">in</span> return_level_priors</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        rl <span class="op">=</span> <span class="fu">quantile</span>(dist, prior.quantile)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> rl <span class="op">&gt;</span> <span class="fl">0.1</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>            Turing.<span class="pp">@addlogprob</span>!(<span class="fu">loglikelihood</span>(prior.distribution, rl))</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>            Turing.<span class="pp">@addlogprob</span>!(<span class="op">-</span><span class="cn">Inf</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data likelihood</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="fu">length</span>(y) <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        y <span class="op">.~</span> dist</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>gev_model_quantile_priors (generic function with 2 methods)</code></pre>
</div>
</div>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb24"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>prior_idata_v2 <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">&quot;prior_v2.nc&quot;</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> <span class="fu">gev_model_quantile_priors</span>([]; return_level_priors<span class="op">=</span>return_level_priors)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">true</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">load_or_sample</span>(fname, model; overwrite<span class="op">=</span>overwrite)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>prior_GEVs_v2 <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(prior_idata_v2.posterior.μ, <span class="fu">exp</span>.(prior_idata_v2.posterior.log_σ), prior_idata_v2.posterior.ξ))</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>fig_prior_comparison <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">500</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    xticks <span class="op">=</span> [<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>]</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">600</span>))</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>, title<span class="op">=</span><span class="st">&quot;Prior v1 Predictive Distribution&quot;</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax1, prior_GEVs_v1, rts; color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.2</span>), ci<span class="op">=</span><span class="fl">0.90</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_mean_curve!</span>(ax1, prior_GEVs_v1, rts; color<span class="op">=:</span>blue, linewidth<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>, title<span class="op">=</span><span class="st">&quot;Prior v2 Predictive Distribution&quot;</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax2, prior_GEVs_v2, rts; color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.2</span>), ci<span class="op">=</span><span class="fl">0.90</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_mean_curve!</span>(ax2, prior_GEVs_v2, rts; color<span class="op">=:</span>blue, linewidth<span class="op">=</span><span class="fl">3</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linkaxes!</span>(ax1, ax2)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Only a single thread available: MCMC chains are not sampled in parallel
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ AbstractMCMC C:\Users\Owner\.julia\packages\AbstractMCMC\nQLlh\src\sample.jl:410</span>
<span class="ansi-green-fg">Sampling (1 thread)   0%|█                              |  ETA: N/A</span>
<span class="ansi-green-fg">Sampling (1 thread)   0%|█                              |  ETA: 0:05:20</span>
<span class="ansi-green-fg">Sampling (1 thread)   1%|█                              |  ETA: 0:02:40</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:01:46</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:01:20</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:01:04</span>
<span class="ansi-green-fg">Sampling (1 thread)   3%|█                              |  ETA: 0:00:53</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:00:46</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:00:40</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:00:36</span>
<span class="ansi-green-fg">Sampling (1 thread)   5%|██                             |  ETA: 0:00:32</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|██                             |  ETA: 0:00:29</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|██                             |  ETA: 0:00:27</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|███                            |  ETA: 0:00:25</span>
<span class="ansi-green-fg">Sampling (1 thread)   7%|███                            |  ETA: 0:00:23</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:00:22</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:00:20</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:00:19</span>
<span class="ansi-green-fg">Sampling (1 thread)   9%|███                            |  ETA: 0:00:18</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|███                            |  ETA: 0:00:17</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|████                           |  ETA: 0:00:16</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|████                           |  ETA: 0:00:15</span>
<span class="ansi-green-fg">Sampling (1 thread)  11%|████                           |  ETA: 0:00:15</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:14</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  13%|█████                          |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  15%|█████                          |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|█████                          |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|█████                          |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|██████                         |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  17%|██████                         |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  19%|██████                         |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  21%|███████                        |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  23%|████████                       |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  25%|████████                       |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|████████                       |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|█████████                      |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|█████████                      |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  27%|█████████                      |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  29%|█████████                      |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  31%|██████████                     |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|██████████                     |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|██████████                     |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|███████████                    |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  33%|███████████                    |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  35%|███████████                    |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  37%|████████████                   |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  39%|█████████████                  |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  41%|█████████████                  |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|█████████████                  |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|██████████████                 |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|██████████████                 |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  43%|██████████████                 |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  45%|██████████████                 |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  47%|███████████████                |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|███████████████                |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|███████████████                |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|████████████████               |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  49%|████████████████               |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  51%|████████████████               |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|████████████████               |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|█████████████████              |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|█████████████████              |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  53%|█████████████████              |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  54%|█████████████████              |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  54%|█████████████████              |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  55%|█████████████████              |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  55%|██████████████████             |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  57%|██████████████████             |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  57%|██████████████████             |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  58%|██████████████████             |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  58%|███████████████████            |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  59%|███████████████████            |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  61%|███████████████████            |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  63%|████████████████████           |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  65%|█████████████████████          |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  67%|█████████████████████          |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|█████████████████████          |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|██████████████████████         |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|██████████████████████         |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  69%|██████████████████████         |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  71%|███████████████████████        |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  73%|███████████████████████        |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|███████████████████████        |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|███████████████████████        |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|████████████████████████       |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  75%|████████████████████████       |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  77%|████████████████████████       |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  79%|█████████████████████████      |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  81%|██████████████████████████     |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  83%|██████████████████████████     |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|██████████████████████████     |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  85%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  87%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  89%|████████████████████████████   |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|████████████████████████████   |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|████████████████████████████   |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|█████████████████████████████  |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  91%|█████████████████████████████  |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  93%|█████████████████████████████  |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|█████████████████████████████  |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  95%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  97%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  99%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread) 100%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread) 100%|███████████████████████████████| Time: 0:00:03</span>
<span class="ansi-bright-black-fg">Sampling (1 thread) 100%|███████████████████████████████| Time: 0:00:03</span>
<span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Sampled and cached samples to D:\FALL 2025\CEVE 543\assignment\prior_v2.nc
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-19-output-2.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb25"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">##lab 4, part 3</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>my_rainfall <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(stnid <span class="op">==</span> !!my_stnid)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(date)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">skipmissing</span>(<span class="fu">ustrip</span>.(u<span class="st">&quot;inch&quot;</span>, my_rainfall.rainfall)))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>bayes_model <span class="op">=</span> <span class="fu">gev_model_quantile_priors</span>(y_obs; return_level_priors<span class="op">=</span>return_level_priors)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>mle_estimate <span class="op">=</span> <span class="fu">maximum_likelihood</span>(bayes_model, <span class="fu">NelderMead</span>(); maxiters<span class="op">=</span><span class="fl">10_000</span>, reltol<span class="op">=</span><span class="fl">1e-6</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>mle_estimate.optim_result</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>θ₀ <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fu">log</span>(<span class="fl">1.0</span>), <span class="fl">0.0</span>]  <span class="co"># initial guess for [μ, log_σ, ξ]</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>map_estimate <span class="op">=</span> <span class="fu">maximum_a_posteriori</span>(bayes_model, <span class="fu">NelderMead</span>(); initial_params<span class="op">=</span>θ₀, maxiters<span class="op">=</span><span class="fl">10_000</span>, reltol<span class="op">=</span><span class="fl">1e-6</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>map_estimate.optim_result</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>original_model <span class="op">=</span> <span class="fu">gev_model</span>(y_obs)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>map_estimate_original <span class="op">=</span> <span class="fu">maximum_a_posteriori</span>(original_model, <span class="fu">NelderMead</span>(); initial_params<span class="op">=</span>θ₀, maxiters<span class="op">=</span><span class="fl">10_000</span>, reltol<span class="op">=</span><span class="fl">1e-6</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>map_estimate_original.optim_result</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>mle_dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(mle_estimate.values[<span class="fl">1</span>], <span class="fu">exp</span>(mle_estimate.values[<span class="fl">2</span>]), mle_estimate.values[<span class="fl">3</span>])</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>map_dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(map_estimate.values[<span class="fl">1</span>], <span class="fu">exp</span>(map_estimate.values[<span class="fl">2</span>]), map_estimate.values[<span class="fl">3</span>])</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>map_dist_original <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(map_estimate_original.values[<span class="fl">1</span>], <span class="fu">exp</span>(map_estimate_original.values[<span class="fl">2</span>]), map_estimate_original.values[<span class="fl">3</span>])</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Distributions.GeneralizedExtremeValue{Float64}(μ=3.3212771097479523, σ=1.2247591766877546, ξ=0.18108592435173576)</code></pre>
</div>
</div>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb27"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">###lab 4, part 3.3</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>posterior_idata <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">&quot;posterior_data.nc&quot;</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">true</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">load_or_sample</span>(fname, bayes_model; overwrite<span class="op">=</span>overwrite)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>posterior_GEVs <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(posterior_idata.posterior.μ, <span class="fu">exp</span>.(posterior_idata.posterior.log_σ), posterior_idata.posterior.ξ))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Only a single thread available: MCMC chains are not sampled in parallel
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ AbstractMCMC C:\Users\Owner\.julia\packages\AbstractMCMC\nQLlh\src\sample.jl:410</span>
<span class="ansi-green-fg">Sampling (1 thread)   0%|█                              |  ETA: N/A</span>
<span class="ansi-green-fg">Sampling (1 thread)   0%|█                              |  ETA: 0:04:20</span>
<span class="ansi-green-fg">Sampling (1 thread)   1%|█                              |  ETA: 0:02:13</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:01:30</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:01:09</span>
<span class="ansi-green-fg">Sampling (1 thread)   2%|█                              |  ETA: 0:00:57</span>
<span class="ansi-green-fg">Sampling (1 thread)   3%|█                              |  ETA: 0:00:49</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:00:43</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:00:38</span>
<span class="ansi-green-fg">Sampling (1 thread)   4%|██                             |  ETA: 0:00:34</span>
<span class="ansi-green-fg">Sampling (1 thread)   5%|██                             |  ETA: 0:00:31</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|██                             |  ETA: 0:00:29</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|██                             |  ETA: 0:00:27</span>
<span class="ansi-green-fg">Sampling (1 thread)   6%|███                            |  ETA: 0:00:25</span>
<span class="ansi-green-fg">Sampling (1 thread)   7%|███                            |  ETA: 0:00:24</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:00:22</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:00:21</span>
<span class="ansi-green-fg">Sampling (1 thread)   8%|███                            |  ETA: 0:00:20</span>
<span class="ansi-green-fg">Sampling (1 thread)   9%|███                            |  ETA: 0:00:19</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|███                            |  ETA: 0:00:18</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|████                           |  ETA: 0:00:18</span>
<span class="ansi-green-fg">Sampling (1 thread)  10%|████                           |  ETA: 0:00:17</span>
<span class="ansi-green-fg">Sampling (1 thread)  11%|████                           |  ETA: 0:00:17</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:16</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:15</span>
<span class="ansi-green-fg">Sampling (1 thread)  12%|████                           |  ETA: 0:00:15</span>
<span class="ansi-green-fg">Sampling (1 thread)  13%|█████                          |  ETA: 0:00:14</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:14</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:14</span>
<span class="ansi-green-fg">Sampling (1 thread)  14%|█████                          |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  15%|█████                          |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|█████                          |  ETA: 0:00:13</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|█████                          |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  16%|██████                         |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  17%|██████                         |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:12</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  18%|██████                         |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  19%|██████                         |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:11</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  20%|███████                        |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  21%|███████                        |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  22%|███████                        |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  23%|████████                       |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  24%|████████                       |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  25%|████████                       |  ETA: 0:00:10</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|████████                       |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|█████████                      |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  26%|█████████                      |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  27%|█████████                      |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  28%|█████████                      |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  29%|█████████                      |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:09</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  30%|██████████                     |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  31%|██████████                     |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|██████████                     |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|██████████                     |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  32%|███████████                    |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  33%|███████████                    |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  34%|███████████                    |  ETA: 0:00:08</span>
<span class="ansi-green-fg">Sampling (1 thread)  35%|███████████                    |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  36%|████████████                   |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  37%|████████████                   |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  38%|████████████                   |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  39%|█████████████                  |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:07</span>
<span class="ansi-green-fg">Sampling (1 thread)  40%|█████████████                  |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  41%|█████████████                  |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|█████████████                  |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|██████████████                 |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  42%|██████████████                 |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  43%|██████████████                 |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  44%|██████████████                 |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  45%|██████████████                 |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  46%|███████████████                |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  47%|███████████████                |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|███████████████                |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|███████████████                |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  48%|████████████████               |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  49%|████████████████               |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  50%|████████████████               |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  51%|████████████████               |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|████████████████               |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|█████████████████              |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  52%|█████████████████              |  ETA: 0:00:06</span>
<span class="ansi-green-fg">Sampling (1 thread)  53%|█████████████████              |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  54%|█████████████████              |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  54%|█████████████████              |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  55%|█████████████████              |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  55%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  56%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  57%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  57%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  58%|██████████████████             |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  58%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  59%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  60%|███████████████████            |  ETA: 0:00:05</span>
<span class="ansi-green-fg">Sampling (1 thread)  61%|███████████████████            |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  62%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  63%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  64%|████████████████████           |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  65%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  66%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  67%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|█████████████████████          |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|██████████████████████         |  ETA: 0:00:04</span>
<span class="ansi-green-fg">Sampling (1 thread)  68%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  69%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  70%|██████████████████████         |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  71%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  72%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  73%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|███████████████████████        |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  74%|████████████████████████       |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  75%|████████████████████████       |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  76%|████████████████████████       |  ETA: 0:00:03</span>
<span class="ansi-green-fg">Sampling (1 thread)  77%|████████████████████████       |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  78%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  79%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  80%|█████████████████████████      |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  81%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  82%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  83%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|██████████████████████████     |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|███████████████████████████    |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  84%|███████████████████████████    |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  85%|███████████████████████████    |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:02</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  86%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  87%|███████████████████████████    |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  88%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  89%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|████████████████████████████   |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  90%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  91%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  92%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  93%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|█████████████████████████████  |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|██████████████████████████████ |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  94%|██████████████████████████████ |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  95%|██████████████████████████████ |  ETA: 0:00:01</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  96%|██████████████████████████████ |  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  97%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  98%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread)  99%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread) 100%|███████████████████████████████|  ETA: 0:00:00</span>
<span class="ansi-green-fg">Sampling (1 thread) 100%|███████████████████████████████| Time: 0:00:09</span>
<span class="ansi-bright-black-fg">Sampling (1 thread) 100%|███████████████████████████████| Time: 0:00:09</span>
<span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Sampled and cached samples to D:\FALL 2025\CEVE 543\assignment\posterior_data.nc
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>32000-element Vector{GeneralizedExtremeValue{Float64}}:
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.157040556775922, σ=1.0793733047081946, ξ=0.21198362314937658)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.1894885477956243, σ=1.180578490906711, ξ=0.19901963840834783)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.3555554456686023, σ=1.1341796231563719, ξ=0.129480570133908)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.465958699202189, σ=1.2214234337899974, ξ=0.2240270990184996)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.0430850732266075, σ=1.1827904545787984, ξ=0.14004192960139944)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.31282386279497, σ=1.0564941200668014, ξ=0.21048996535746178)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.1245408207047856, σ=1.3919188913675655, ξ=0.2544323105142749)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.2691208126460354, σ=1.2988565865503137, ξ=0.2345844207024338)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.302740969201654, σ=1.1153827551796407, ξ=0.15539857889879952)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.181045145920242, σ=1.1428892436454845, ξ=0.13931302295851583)
 ⋮
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.2089451127950617, σ=1.0987919440123153, ξ=0.20442667136177892)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.1774136145006704, σ=1.2603946673603064, ξ=0.21685698370896403)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.3045248041906525, σ=1.2131643483352972, ξ=0.17007980628162675)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.164508996718147, σ=1.177741783867528, ξ=0.1959576267433321)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.302731222831372, σ=1.0960607078427296, ξ=0.19492817866580575)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.2445289744832153, σ=1.1358727795939563, ξ=0.19341406958505836)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.395928247792815, σ=1.2718634998714506, ξ=0.1495762635266941)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.4224241137873324, σ=1.1533972240431285, ξ=0.16474361371804355)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.4224241137873324, σ=1.1533972240431285, ξ=0.16474361371804355)</code></pre>
</div>
</div>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb29"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">900</span>, <span class="fl">500</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">500</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Return Level Uncertainty: Prior vs Posterior&quot;</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>[<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax1, prior_GEVs_v2, rts; color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.2</span>), ci<span class="op">=</span><span class="fl">0.90</span>, label<span class="op">=</span><span class="st">&quot;Prior 90% CI&quot;</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax1, posterior_GEVs, rts; color<span class="op">=</span>(<span class="op">:</span>orange, <span class="fl">0.4</span>), ci<span class="op">=</span><span class="fl">0.90</span>, label<span class="op">=</span><span class="st">&quot;Posterior 90% CI&quot;</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_mean_curve!</span>(ax1, posterior_GEVs, rts; color<span class="op">=:</span>blue, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">&quot;Posterior Mean&quot;</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    mean_return_levels <span class="op">=</span> [<span class="fu">quantile</span>(mle_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> rts]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax1, rts, mean_return_levels, color<span class="op">=:</span>red, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">&quot;MLE&quot;</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax1; position<span class="op">=:</span>lt)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">900</span>, <span class="fl">500</span>))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">500</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Point Estimates Comparison&quot;</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>[<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>])</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax1, prior_GEVs_v2, rts; color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.1</span>), ci<span class="op">=</span><span class="fl">0.90</span>, label<span class="op">=</span><span class="st">&quot;Prior 90% CI&quot;</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax1, posterior_GEVs, rts; color<span class="op">=</span>(<span class="op">:</span>orange, <span class="fl">0.3</span>), ci<span class="op">=</span><span class="fl">0.90</span>, label<span class="op">=</span><span class="st">&quot;Posterior 90% CI&quot;</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    mle_return_levels <span class="op">=</span> [<span class="fu">quantile</span>(mle_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> rts]</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    map_return_levels <span class="op">=</span> [<span class="fu">quantile</span>(map_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> rts]</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    map_original_return_levels <span class="op">=</span> [<span class="fu">quantile</span>(map_dist_original, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> rts]</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax1, rts, mle_return_levels, color<span class="op">=:</span>red, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">&quot;MLE&quot;</span>)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax1, rts, map_return_levels, color<span class="op">=:</span>green, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">&quot;MAP (with return level priors)&quot;</span>)</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax1, rts, map_original_return_levels, color<span class="op">=:</span>purple, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">&quot;MAP (generic priors only)&quot;</span>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax1; position<span class="op">=:</span>lt)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-22-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb30"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ArviZ.<span class="fu">summarize</span>(posterior_idata)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<table class="caption-top" data-quarto-postprocess="true">
<caption>SummaryStats</caption>
<thead>
<tr class="header headerLastRow">
<th class="rowLabel" data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eti89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_tail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_bulk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rhat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">μ</td>
<td style="text-align: right;">3.302</td>
<td style="text-align: right;">0.119</td>
<td style="text-align: left;">3.12 .. 3.49</td>
<td style="text-align: right;">21009</td>
<td style="text-align: right;">18672</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00087</td>
<td style="text-align: right;">0.00061</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">ξ</td>
<td style="text-align: right;">0.1754</td>
<td style="text-align: right;">0.0531</td>
<td style="text-align: left;">0.0920 .. 0.262</td>
<td style="text-align: right;">21113</td>
<td style="text-align: right;">23535</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00035</td>
<td style="text-align: right;">0.00028</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ</td>
<td style="text-align: right;">0.200</td>
<td style="text-align: right;">0.0774</td>
<td style="text-align: left;">0.0776 .. 0.327</td>
<td style="text-align: right;">21946</td>
<td style="text-align: right;">18318</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00057</td>
<td style="text-align: right;">0.00039</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb31"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_trace_diagnostics</span>(idata, title_prefix<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">400</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract chain x draw arrays for each parameter</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    μ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.μ)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    log_σ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.log_σ)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    ξ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.ξ)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    ndraws, nchains <span class="op">=</span> <span class="fu">size</span>(μ_arr)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Trace plots per chain</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Iteration&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;μ&quot;</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;</span><span class="sc">$</span>title_prefix<span class="st"> Location Parameter Trace&quot;</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>nchains</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax1, <span class="fl">1</span><span class="op">:</span>ndraws, μ_arr[<span class="op">:</span>, c], label<span class="op">=</span><span class="st">&quot;Chain </span><span class="sc">$</span>(c)<span class="st">&quot;</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax1; position<span class="op">=:</span>lb)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">&quot;Iteration&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;log(σ)&quot;</span>,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;</span><span class="sc">$</span>title_prefix<span class="st"> Log-Scale Parameter Trace&quot;</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>nchains</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax2, <span class="fl">1</span><span class="op">:</span>ndraws, log_σ_arr[<span class="op">:</span>, c])</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">3</span>], xlabel<span class="op">=</span><span class="st">&quot;Iteration&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;ξ&quot;</span>,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;</span><span class="sc">$</span>title_prefix<span class="st"> Shape Parameter Trace&quot;</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>nchains</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax3, <span class="fl">1</span><span class="op">:</span>ndraws, ξ_arr[<span class="op">:</span>, c])</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>fig_trace_primary <span class="op">=</span> <span class="fu">plot_trace_diagnostics</span>(posterior_idata, <span class="st">&quot;Primary Station:&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-24-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb32"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_marginal_densities</span>(idata, title_prefix<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">400</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract chain x draw arrays for each parameter</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    μ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.μ)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    log_σ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.log_σ)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    ξ_arr <span class="op">=</span> <span class="fu">Array</span>(idata.posterior.ξ)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Marginal densities aggregated across chains</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;μ&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Density&quot;</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;</span><span class="sc">$</span>title_prefix<span class="st"> Location Posterior&quot;</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax1, <span class="fu">vec</span>(μ_arr), bins<span class="op">=</span><span class="fl">50</span>, normalization<span class="op">=:</span>pdf, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.7</span>))</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">&quot;log(σ)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Density&quot;</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;</span><span class="sc">$</span>title_prefix<span class="st"> Log-Scale Posterior&quot;</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax2, <span class="fu">vec</span>(log_σ_arr), bins<span class="op">=</span><span class="fl">50</span>, normalization<span class="op">=:</span>pdf, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.7</span>))</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">3</span>], xlabel<span class="op">=</span><span class="st">&quot;ξ&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Density&quot;</span>,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;</span><span class="sc">$</span>title_prefix<span class="st"> Shape Posterior&quot;</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax3, <span class="fu">vec</span>(ξ_arr), bins<span class="op">=</span><span class="fl">50</span>, normalization<span class="op">=:</span>pdf, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.7</span>))</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>fig_densities_primary <span class="op">=</span> <span class="fu">plot_marginal_densities</span>(posterior_idata, <span class="st">&quot;Primary Station:&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-25-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode" id="annotated-cell-11"><pre class="sourceCode julia cell-code code-annotation-code"><code class="sourceCode julia"><span id="annotated-cell-11-1"><a href="#annotated-cell-11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_gev_comparison</span>(station_data, extremes_dist, extremes_pwm_dist, turing_dist, station_info)</span>
<span id="annotated-cell-11-2"><a href="#annotated-cell-11-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>()</span>
<span id="annotated-cell-11-3"><a href="#annotated-cell-11-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>],</span>
<span id="annotated-cell-11-4"><a href="#annotated-cell-11-4" aria-hidden="true" tabindex="-1"></a>        xlabel <span class="op">=</span> <span class="st">&quot;Return Period (years)&quot;</span>,</span>
<span id="annotated-cell-11-5"><a href="#annotated-cell-11-5" aria-hidden="true" tabindex="-1"></a>        ylabel <span class="op">=</span> <span class="st">&quot;Return Level (inches)&quot;</span>,</span>
<span id="annotated-cell-11-6"><a href="#annotated-cell-11-6" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">&quot;GEV Fit Comparison</span><span class="sc">\n$</span>(station_info.noaa_id)<span class="st">: </span><span class="sc">$</span>(station_info.name)<span class="st">&quot;</span>,</span>
<span id="annotated-cell-11-7"><a href="#annotated-cell-11-7" aria-hidden="true" tabindex="-1"></a>        xscale <span class="op">=</span> log10)</span>
<span id="annotated-cell-11-8"><a href="#annotated-cell-11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-9"><a href="#annotated-cell-11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot theoretical curves</span></span>
<span id="annotated-cell-11-10"><a href="#annotated-cell-11-10" aria-hidden="true" tabindex="-1"></a>    T_smooth <span class="op">=</span> <span class="fu">create_return_period_range</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">100</span>)</span>
<span id="annotated-cell-11-11"><a href="#annotated-cell-11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-12"><a href="#annotated-cell-11-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extremes.jl MLE curve</span></span>
<span id="annotated-cell-11-13"><a href="#annotated-cell-11-13" aria-hidden="true" tabindex="-1"></a>    levels_extremes <span class="op">=</span> [<span class="fu">quantile</span>(extremes_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> T_smooth]</span>
<span id="annotated-cell-11-14"><a href="#annotated-cell-11-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax, T_smooth, levels_extremes, color <span class="op">=</span> <span class="op">:</span>blue, linewidth <span class="op">=</span> <span class="fl">2</span>, label <span class="op">=</span> <span class="st">&quot;Extremes MLE&quot;</span>)</span>
<span id="annotated-cell-11-15"><a href="#annotated-cell-11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-16"><a href="#annotated-cell-11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extremes.jl PWM curve</span></span>
<span id="annotated-cell-11-17"><a href="#annotated-cell-11-17" aria-hidden="true" tabindex="-1"></a>    levels_extremes_pwm <span class="op">=</span> [<span class="fu">quantile</span>(extremes_pwm_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> T_smooth]</span>
<span id="annotated-cell-11-18"><a href="#annotated-cell-11-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax, T_smooth, levels_extremes_pwm, color <span class="op">=</span> <span class="op">:</span>green, linewidth <span class="op">=</span> <span class="fl">2</span>, linestyle <span class="op">=</span> <span class="op">:</span>dot, label <span class="op">=</span> <span class="st">&quot;Extremes PWM&quot;</span>)</span>
<span id="annotated-cell-11-19"><a href="#annotated-cell-11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-20"><a href="#annotated-cell-11-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Turing.jl curve  </span></span>
<span id="annotated-cell-11-21"><a href="#annotated-cell-11-21" aria-hidden="true" tabindex="-1"></a>    levels_turing <span class="op">=</span> [<span class="fu">quantile</span>(turing_dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> T) for T <span class="kw">in</span> T_smooth]</span>
<span id="annotated-cell-11-22"><a href="#annotated-cell-11-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax, T_smooth, levels_turing, color <span class="op">=</span> <span class="op">:</span>red, linewidth <span class="op">=</span> <span class="fl">2</span>, linestyle <span class="op">=</span> <span class="op">:</span>dash, label <span class="op">=</span> <span class="st">&quot;Turing MLE&quot;</span>)</span>
<span id="annotated-cell-11-23"><a href="#annotated-cell-11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-24"><a href="#annotated-cell-11-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Empirical data points</span></span>
<span id="annotated-cell-11-25"><a href="#annotated-cell-11-25" aria-hidden="true" tabindex="-1"></a>    emp_levels, emp_periods <span class="op">=</span> <span class="fu">weibull_plotting_positions</span>(station_data.rainfall)</span>
<span id="annotated-cell-11-26"><a href="#annotated-cell-11-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax, emp_periods, emp_levels,</span>
<span id="annotated-cell-11-27"><a href="#annotated-cell-11-27" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="op">:</span>black, markersize <span class="op">=</span> <span class="fl">8</span>, marker <span class="op">=</span> <span class="op">:</span>circle,</span>
<span id="annotated-cell-11-28"><a href="#annotated-cell-11-28" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="st">&quot;Observed Data&quot;</span>)</span>
<span id="annotated-cell-11-29"><a href="#annotated-cell-11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-30"><a href="#annotated-cell-11-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standard return periods</span></span>
<span id="annotated-cell-11-31"><a href="#annotated-cell-11-31" aria-hidden="true" tabindex="-1"></a>    return_periods <span class="op">=</span> [<span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>]</span>
<span id="annotated-cell-11-32"><a href="#annotated-cell-11-32" aria-hidden="true" tabindex="-1"></a>    ax.xticks <span class="op">=</span> return_periods</span>
<span id="annotated-cell-11-33"><a href="#annotated-cell-11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-34"><a href="#annotated-cell-11-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax, position <span class="op">=</span> <span class="op">:</span>rb)</span>
<span id="annotated-cell-11-35"><a href="#annotated-cell-11-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="annotated-cell-11-36"><a href="#annotated-cell-11-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="annotated-cell-11-37"><a href="#annotated-cell-11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-11-38"><a href="#annotated-cell-11-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gev_comparison</span>(my_precip, extremes_dist, extremes_pwm_dist, turing_dist, my_station)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-11-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-2-part-a-repeat-task-1-for-4-additional-houston-area-stations-using-identical-methods-pick-one-method-from-task-1---you-dont-need-to-do-all-three-models-we-will-use-mle-gevfit-extremes.jl" class="level3" data-number="1.6">
<h3 data-number="1.6"><span class="header-section-number">1.6</span> Task 2, part a – Repeat Task 1 for 4 additional Houston-area stations using identical methods (pick one method from Task 1 - you don’t need to do all three models), we will use MLE (gevfit) Extremes.jl</h3>
</section>
<section id="finding-nearest-four-stations-so-i-choose-one-at-the-starting-now-choose-more-4so-total-5" class="level3" data-number="1.7">
<h3 data-number="1.7"><span class="header-section-number">1.7</span> Finding Nearest four Stations, so I choose one at the starting, now choose more 4…so total 5</h3>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb33"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the 5 nearest stations to your chosen station</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>nearest_stations <span class="op">=</span> <span class="fu">find_nearest_stations</span>(my_station, stations, <span class="fl">5</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>target_lon <span class="op">=</span> my_station.longitude</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>target_lat <span class="op">=</span> my_station.latitude</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>nearest_with_distance <span class="op">=</span> <span class="pp">@chain</span> nearest_stations <span class="cf">begin</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@mutate</span>(distance_km <span class="op">=</span> <span class="fu">calc_distance</span>(longitude, latitude, !!target_lon, !!target_lat))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@select</span>(noaa_id, name, distance_km, years_of_data)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="st">&quot;Nearest stations to </span><span class="sc">$</span>(my_station.noaa_id)<span class="st">:&quot;</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(nearest_with_distance)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nearest stations to 79-0056:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div><div style = "float: left;"><span>5×4 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;">
<table class="data-frame caption-top" data-quarto-postprocess="true" style="margin-bottom: 6px;">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">noaa_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">distance_km</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">years_of_data</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Unitful.Quantity{Float64, 𝐋, Unitful.FreeUnits{(km,), 𝐋, nothing}}">Quantity…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">79-0056</td>
<td style="text-align: left;">HOUSTON WB CITY</td>
<td style="text-align: right;">0.0 km</td>
<td style="text-align: right;">129</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">41-4321</td>
<td style="text-align: left;">HOUSTON HEIGHTS</td>
<td style="text-align: right;">7.22648 km</td>
<td style="text-align: right;">62</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">41-4326</td>
<td style="text-align: left;">HOUSTON-PORT</td>
<td style="text-align: right;">7.88331 km</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: left;">41-4323</td>
<td style="text-align: left;">HOUSTON INDEP HTS</td>
<td style="text-align: right;">12.8861 km</td>
<td style="text-align: right;">75</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: left;">41-4331</td>
<td style="text-align: left;">HOUSTON SPRING BRANCH</td>
<td style="text-align: right;">13.592 km</td>
<td style="text-align: right;">75</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<ol type="1">
<li>Find the 4 geographically closest stations to your chosen station</li>
<li>Calculate distance in kilometers from your station to each nearby station</li>
<li>Select relevant columns for display: station ID, name, distance, and data years</li>
</ol>
</section>
<section id="fitting-gev-to-multiple-stations" class="level3" data-number="1.8">
<h3 data-number="1.8"><span class="header-section-number">1.8</span> Fitting GEV to Multiple Stations</h3>
<p>Let’s fit GEV distributions to all stations (your chosen station plus the 4 nearest): To fit this we are choosing the MLE- Extremes.jl using gevfit because task 2, part a says to choose a method among MLE- Extremes.jl using gevfit or Methods of Moments with Extremes.jl or MLE using the Turing.jl workflow a Bayesian approach</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb35"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to fit GEV to a single station</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to fit GEV to a single station</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">fit_station_gev</span>(station_row)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    target_stnid <span class="op">=</span> station_row.stnid</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    st_precip <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@filter</span>(stnid <span class="op">==</span> !!target_stnid)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@arrange</span>(date)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    y_st <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">skipmissing</span>(<span class="fu">ustrip</span>.(u<span class="st">&quot;inch&quot;</span>, st_precip.rainfall)))</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit using Extremes.jl</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    extremes_fit_st <span class="op">=</span> <span class="fu">gevfit</span>(y_st)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    μ_st <span class="op">=</span> <span class="fu">location</span>(extremes_fit_st)[<span class="fl">1</span>]</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    σ_st <span class="op">=</span> <span class="fu">scale</span>(extremes_fit_st)[<span class="fl">1</span>]</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    ξ_st <span class="op">=</span> <span class="fu">shape</span>(extremes_fit_st)[<span class="fl">1</span>]</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>        distribution <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_st, σ_st, ξ_st),</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>        info <span class="op">=</span> (noaa_id <span class="op">=</span> station_row.noaa_id, n_years <span class="op">=</span> <span class="fu">length</span>(y_st)),</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit all stations using map</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>station_results <span class="op">=</span> <span class="fu">map</span>(fit_station_gev, <span class="fu">eachrow</span>(nearest_stations))</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>station_fits <span class="op">=</span> [r.distribution for r <span class="kw">in</span> station_results]</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>station_info <span class="op">=</span> [r.info for r <span class="kw">in</span> station_results]</span></code></pre></div>
</div>
<ol type="1">
<li>Extract station ID first to avoid variable scoping issues</li>
<li>Filter rainfall data for this specific station</li>
<li>Sort the data chronologically by date</li>
<li>Apply the fitting function to each of the nearest stations</li>
<li>Extract the fitted GEV distribution objects from results</li>
<li>Extract station information (ID and years of data) from results</li>
</ol>
<p>Let’s visualize the geographic distribution of these stations:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb36"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_station_map</span>(my_station, nearest_stations)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create map plot with all stations</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size <span class="op">=</span> (<span class="fl">800</span>, <span class="fl">600</span>))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    ga <span class="op">=</span> <span class="fu">GeoAxis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>]; source <span class="op">=</span> <span class="st">&quot;+proj=latlong&quot;</span>, dest <span class="op">=</span> <span class="st">&quot;+proj=merc&quot;</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">&quot;Selected Stations for GEV Analysis&quot;</span>, xgridvisible <span class="op">=</span> <span class="cn">false</span>, ygridvisible <span class="op">=</span> <span class="cn">false</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add US states (white with black borders)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    states <span class="op">=</span> GeoMakie.<span class="fu">naturalearth</span>(<span class="st">&quot;admin_1_states_provinces_lakes&quot;</span>, <span class="fl">110</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">poly!</span>(ga, states.geometry;</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        strokecolor <span class="op">=</span> <span class="op">:</span>black, strokewidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="op">:</span>white)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot all stations as small dots colored by years of data</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ga, stations.longitude, stations.latitude;</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> stations.years_of_data, colormap <span class="op">=</span> <span class="op">:</span>viridis, markersize <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="st">&quot;All stations&quot;</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot nearest stations with distinct colors</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> ColorSchemes.Set1_5</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ga, nearest_stations.longitude, nearest_stations.latitude,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> colors[<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(nearest_stations.longitude)],</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        markersize <span class="op">=</span> <span class="fl">12</span>, strokewidth <span class="op">=</span> <span class="fl">2</span>, strokecolor <span class="op">=</span> <span class="op">:</span>black,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="st">&quot;Analysis stations&quot;</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Highlight the chosen station</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ga, [my_station.longitude], [my_station.latitude],</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="op">:</span>gold, markersize <span class="op">=</span> <span class="fl">15</span>, marker <span class="op">=</span> <span class="op">:</span>star5,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>        strokewidth <span class="op">=</span> <span class="fl">2</span>, strokecolor <span class="op">=</span> <span class="op">:</span>black,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="st">&quot;My station&quot;</span>)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set plot bounds based on data bounds plus padding</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    min_lon, max_lon <span class="op">=</span> <span class="fu">extrema</span>(stations.longitude)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    min_lat, max_lat <span class="op">=</span> <span class="fu">extrema</span>(stations.latitude)</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlims!</span>(ga, min_lon <span class="op">-</span> delta, max_lon <span class="op">+</span> delta)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylims!</span>(ga, min_lat <span class="op">-</span> delta, max_lat <span class="op">+</span> delta)</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add colorbar for years of data</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Colorbar</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], label <span class="op">=</span> <span class="st">&quot;Years of Data&quot;</span>, colormap <span class="op">=</span> <span class="op">:</span>viridis,</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>        limits <span class="op">=</span> (<span class="fu">minimum</span>(stations.years_of_data), <span class="fu">maximum</span>(stations.years_of_data)))</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ga, position <span class="op">=</span> <span class="op">:</span>lt)</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_station_map</span>(my_station, nearest_stations)</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="co">####task 2, part b,   also this part of the code will give corresponding return level value for the 4 stations</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="fl">50</span>  <span class="co"># return period</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>rp50 <span class="op">=</span> <span class="fu">DataFrame</span>(</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    noaa_id <span class="op">=</span> [info.noaa_id for info <span class="kw">in</span> station_info],</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    n_years <span class="op">=</span> [info.n_years for info <span class="kw">in</span> station_info],</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    RP50    <span class="op">=</span> [<span class="fu">quantile</span>(dist, <span class="fl">1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span>T) for dist <span class="kw">in</span> station_fits],</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(rp50)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div><div style = "float: left;"><span>5×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;">
<table class="data-frame caption-top" data-quarto-postprocess="true" style="margin-bottom: 6px;">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">noaa_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">n_years</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">RP50</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: left;">79-0056</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">10.7271</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: left;">41-4321</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">11.5568</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: left;">41-4326</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">26.2017</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: left;">41-4323</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">12.5633</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: left;">41-4331</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">13.0843</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="56" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb37"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">######part 2, c - plotting the 5 stations data at once</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>obs_per_year <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@group_by</span>(year)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@summarise</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>        station_count <span class="op">=</span> <span class="fu">n</span>(),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(<span class="fu">desc</span>(station_count))</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>target_location <span class="op">=</span> <span class="st">&quot;Houston WB station&quot;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>target_lon <span class="op">=</span> <span class="op">-</span><span class="fl">95.3593</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>target_lat <span class="op">=</span> <span class="fl">29.7622</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calc_distance</span>(lon1, lat1, lon2, lat2)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    R <span class="op">=</span> <span class="fl">6378.0</span>u<span class="st">&quot;km&quot;</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert degrees to radians</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    φ<span class="fl">1</span> <span class="op">=</span> <span class="fu">deg2rad</span>(lat1)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    φ<span class="fl">2</span> <span class="op">=</span> <span class="fu">deg2rad</span>(lat2)</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    Δφ <span class="op">=</span> <span class="fu">deg2rad</span>(lat2 <span class="op">-</span> lat1)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    Δλ <span class="op">=</span> <span class="fu">deg2rad</span>(lon2 <span class="op">-</span> lon1)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Haversine formula</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="fu">sin</span>(Δφ <span class="op">/</span> <span class="fl">2</span>)<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fu">cos</span>(φ<span class="fl">1</span>) <span class="op">*</span> <span class="fu">cos</span>(φ<span class="fl">2</span>) <span class="op">*</span> <span class="fu">sin</span>(Δλ <span class="op">/</span> <span class="fl">2</span>)<span class="op">^</span><span class="fl">2</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu">atan</span>(<span class="fu">sqrt</span>(a), <span class="fu">sqrt</span>(<span class="fl">1</span> <span class="op">-</span> a))</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> R <span class="op">*</span> c</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>stations <span class="op">=</span> <span class="pp">@chain</span> stations <span class="cf">begin</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@mutate</span>(distance_km <span class="op">=</span> <span class="fu">calc_distance</span>(longitude, latitude, !!target_lon, !!target_lat))</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(distance_km)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>stations</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>closest_station <span class="op">=</span> <span class="fu">first</span>(stations)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>closest_stnid <span class="op">=</span> closest_station.stnid</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>closest_rainfall <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(stnid <span class="op">==</span> !!closest_stnid)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>closest_rainfall</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with other nearby stations</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_nearby_comparison</span>(stations_df, rainfall_data; n_stations <span class="op">=</span> <span class="fl">4</span>)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size <span class="op">=</span> (<span class="fl">800</span>, <span class="fl">400</span>))</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>],</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>        ylabel <span class="op">=</span> <span class="st">&quot;Annual Maximum Rainfall&quot;</span>,</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="st">&quot;Comparison of all </span><span class="sc">$</span>(n_stations)<span class="st"> stations &quot;</span>,</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>        dim2_conversion <span class="op">=</span> rainfall_conversion)</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="fu">get</span>(colorschemes[<span class="op">:</span>Set1_5], i <span class="op">/</span> (n_stations<span class="op">-</span><span class="fl">1</span>)) for i <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span>n_stations<span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, station) <span class="kw">in</span> <span class="fu">enumerate</span>(<span class="fu">eachrow</span>(stations_df[<span class="fl">1</span><span class="op">:</span>n_stations, <span class="op">:</span>]))</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>        station_id <span class="op">=</span> station.stnid</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>        rainfall <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@filter</span>(stnid <span class="op">==</span> !!station_id)</span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines!</span>(ax, rainfall.year, rainfall.rainfall,</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> colors[i], linewidth <span class="op">=</span> <span class="fl">2</span>,</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> <span class="st">&quot;</span><span class="sc">$</span>(station.noaa_id)<span class="st">&quot;</span>)</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scatter!</span>(ax, rainfall.year, rainfall.rainfall,</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> colors[i], markersize <span class="op">=</span> <span class="fl">10</span>)</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlims!</span>(ax, <span class="fl">1950</span>, <span class="fl">2025</span>)</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax, position <span class="op">=</span> <span class="op">:</span>lt)</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_nearby_comparison</span>(stations, rainfall_data; n_stations <span class="op">=</span> <span class="fl">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-29-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<section id="task-3-part-a-nonstationarity-analysis" class="level4" data-number="1.8.1">
<h4 data-number="1.8.1"><span class="header-section-number">1.8.1</span> Task 3, part a: Nonstationarity analysis:</h4>
</section>
</section>
<section id="conduct-mann-kendall-trend-test-on-annual-maxima-report-test-statistic-p-value-and-interpretation" class="level3" data-number="1.9">
<h3 data-number="1.9"><span class="header-section-number">1.9</span> Conduct Mann-Kendall trend test on annual maxima; report test statistic, p-value, and interpretation</h3>
<div id="58" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb38"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>lab_dir <span class="op">=</span> <span class="fu">dirname</span>(<span class="st">&quot;D:</span><span class="sc">\\</span><span class="st">FALL 2025</span><span class="sc">\\</span><span class="st">CEVE 543</span><span class="sc">\\</span><span class="st">assignment</span><span class="sc">\\</span><span class="st">prblmset1</span><span class="sc">\\</span><span class="st">&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">activate</span>(lab_dir)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">instantiate</span>() <span class="co"># uncomment this the first time you run the lab to install packages, then comment it back</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">  Activating</span> project at `D:\FALL 2025\CEVE 543\assignment\prblmset1`
</pre>
</div>
</div>
</div>
<div id="60" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb39"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">rm</span>(<span class="st">&quot;NCDatasets&quot;</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">gc</span>()                                <span class="co"># clean unused artifacts</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Delete the broken artifact folder if it still exists (optional):</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   C:\Users\Owner\.julia\artifacts\bade52dee31407c455f119c194ded80196069aab</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># You can delete it from Explorer.</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">&quot;JULIA_PKG_USE_CLI_GIT&quot;</span>] <span class="op">=</span> <span class="st">&quot;true&quot;</span>   <span class="co"># helps behind firewalls</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">&quot;JULIA_PKG_SERVER&quot;</span>] <span class="op">=</span> <span class="st">&quot;https://pkg.julialang.org&quot;</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">&quot;NCDatasets&quot;</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">build</span>(<span class="st">&quot;NCDatasets&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">    Updating</span> `D:\FALL 2025\CEVE 543\assignment\prblmset1\Project.toml`
  <span class="ansi-bright-black-fg">[85f8d34a] </span><span class="ansi-bright-red-fg">- NCDatasets v0.14.8</span>
<span class="ansi-green-fg ansi-bold">    Updating</span> `D:\FALL 2025\CEVE 543\assignment\prblmset1\Manifest.toml`
  <span class="ansi-bright-black-fg">[179af706] </span><span class="ansi-bright-red-fg">- CFTime v0.2.4</span>
  <span class="ansi-bright-black-fg">[1fbeeb36] </span><span class="ansi-bright-red-fg">- CommonDataModel v0.3.10</span>
  <span class="ansi-bright-black-fg">[3c3547ce] </span><span class="ansi-bright-red-fg">- DiskArrays v0.4.16</span>
  <span class="ansi-bright-black-fg">[8ac3fa9e] </span><span class="ansi-bright-red-fg">- LRUCache v1.6.2</span>
  <span class="ansi-bright-black-fg">[3da0fdf6] </span><span class="ansi-bright-red-fg">- MPIPreferences v0.1.11</span>
  <span class="ansi-bright-black-fg">[85f8d34a] </span><span class="ansi-bright-red-fg">- NCDatasets v0.14.8</span>
  <span class="ansi-bright-black-fg">[0b7ba130] </span><span class="ansi-bright-red-fg">- Blosc_jll v1.21.7+0</span>
  <span class="ansi-bright-black-fg">[0234f1f7] </span><span class="ansi-bright-red-fg">- HDF5_jll v1.14.6+0</span>
  <span class="ansi-bright-black-fg">[e33a78d0] </span><span class="ansi-bright-red-fg">- Hwloc_jll v2.12.2+0</span>
  <span class="ansi-bright-black-fg">[7cb0a576] </span><span class="ansi-bright-red-fg">- MPICH_jll v4.3.1+0</span>
  <span class="ansi-bright-black-fg">[f1f71cc9] </span><span class="ansi-bright-red-fg">- MPItrampoline_jll v5.5.4+0</span>
  <span class="ansi-bright-black-fg">[9237b28f] </span><span class="ansi-bright-red-fg">- MicrosoftMPI_jll v10.1.4+3</span>
  <span class="ansi-bright-black-fg">[7243133f] </span><span class="ansi-bright-red-fg">- NetCDF_jll v401.900.300+0</span>
  <span class="ansi-bright-black-fg">[fe0851c0] </span><span class="ansi-bright-red-fg">- OpenMPI_jll v5.0.8+0</span>
  <span class="ansi-bright-black-fg">[a65dc6b1] </span><span class="ansi-bright-red-fg">- Xorg_libpciaccess_jll v0.18.1+0</span>
  <span class="ansi-bright-black-fg">[477f73a3] </span><span class="ansi-bright-red-fg">- libaec_jll v1.1.4+0</span>
  <span class="ansi-bright-black-fg">[337d8026] </span><span class="ansi-bright-red-fg">- libzip_jll v1.11.3+0</span>
<span class="ansi-green-fg ansi-bold">      Active</span> manifest files: 10 found
<span class="ansi-green-fg ansi-bold">      Active</span> artifact files: 124 found
<span class="ansi-green-fg ansi-bold">      Active</span> scratchspaces: 3 found
<span class="ansi-green-fg ansi-bold">     Deleted</span> no artifacts, repos, packages or scratchspaces
<span class="ansi-green-fg ansi-bold">   Resolving</span> package versions...
<span class="ansi-green-fg ansi-bold">    Updating</span> `D:\FALL 2025\CEVE 543\assignment\prblmset1\Project.toml`
  <span class="ansi-bright-black-fg">[85f8d34a] </span><span class="ansi-bright-green-fg">+ NCDatasets v0.14.8</span>
<span class="ansi-green-fg ansi-bold">    Updating</span> `D:\FALL 2025\CEVE 543\assignment\prblmset1\Manifest.toml`
  <span class="ansi-bright-black-fg">[179af706] </span><span class="ansi-bright-green-fg">+ CFTime v0.2.4</span>
<span class="ansi-yellow-fg">⌅</span> <span class="ansi-bright-black-fg">[1fbeeb36] </span><span class="ansi-bright-green-fg">+ CommonDataModel v0.3.10</span>
  <span class="ansi-bright-black-fg">[3c3547ce] </span><span class="ansi-bright-green-fg">+ DiskArrays v0.4.16</span>
  <span class="ansi-bright-black-fg">[8ac3fa9e] </span><span class="ansi-bright-green-fg">+ LRUCache v1.6.2</span>
  <span class="ansi-bright-black-fg">[3da0fdf6] </span><span class="ansi-bright-green-fg">+ MPIPreferences v0.1.11</span>
  <span class="ansi-bright-black-fg">[85f8d34a] </span><span class="ansi-bright-green-fg">+ NCDatasets v0.14.8</span>
  <span class="ansi-bright-black-fg">[0b7ba130] </span><span class="ansi-bright-green-fg">+ Blosc_jll v1.21.7+0</span>
  <span class="ansi-bright-black-fg">[0234f1f7] </span><span class="ansi-bright-green-fg">+ HDF5_jll v1.14.6+0</span>
  <span class="ansi-bright-black-fg">[e33a78d0] </span><span class="ansi-bright-green-fg">+ Hwloc_jll v2.12.2+0</span>
  <span class="ansi-bright-black-fg">[7cb0a576] </span><span class="ansi-bright-green-fg">+ MPICH_jll v4.3.1+0</span>
  <span class="ansi-bright-black-fg">[f1f71cc9] </span><span class="ansi-bright-green-fg">+ MPItrampoline_jll v5.5.4+0</span>
  <span class="ansi-bright-black-fg">[9237b28f] </span><span class="ansi-bright-green-fg">+ MicrosoftMPI_jll v10.1.4+3</span>
  <span class="ansi-bright-black-fg">[7243133f] </span><span class="ansi-bright-green-fg">+ NetCDF_jll v401.900.300+0</span>
  <span class="ansi-bright-black-fg">[fe0851c0] </span><span class="ansi-bright-green-fg">+ OpenMPI_jll v5.0.8+0</span>
  <span class="ansi-bright-black-fg">[a65dc6b1] </span><span class="ansi-bright-green-fg">+ Xorg_libpciaccess_jll v0.18.1+0</span>
  <span class="ansi-bright-black-fg">[477f73a3] </span><span class="ansi-bright-green-fg">+ libaec_jll v1.1.4+0</span>
  <span class="ansi-bright-black-fg">[337d8026] </span><span class="ansi-bright-green-fg">+ libzip_jll v1.11.3+0</span>
<span class="ansi-cyan-fg ansi-bold">        Info</span> Packages marked with <span class="ansi-yellow-fg">⌅</span> have new versions available but compatibility constraints restrict them from upgrading. To see why use `status --outdated -m`
</pre>
</div>
</div>
</div>
<div id="62" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb40"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">&quot;LaTeXStrings&quot;</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">TidierFiles</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Downloads</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">NCDatasets</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">TidierData</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span>: I</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ArviZ</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Optim</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Statistics</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CairoMakie</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">GeoMakie</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LaTeXStrings</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>CairoMakie.<span class="fu">activate!</span>(<span class="kw">type</span><span class="op">=</span><span class="st">&quot;svg&quot;</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">&quot;DATAFRAMES_ROWS&quot;</span>] <span class="op">=</span> <span class="fl">5</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">   Resolving</span> package versions...
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\prblmset1\Project.toml`
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\prblmset1\Manifest.toml`
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>5</code></pre>
</div>
</div>
<div id="64" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb42"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="st">&quot;util.jl&quot;</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="fu">MersenneTwister</span>(<span class="fl">543</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_parts :: Union{Tuple{Int64, Vararg{Any, 6}}, Tuple{Int64, Any, Any, Any, Any, Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_parts :: Union{Tuple{Int64, Vararg{Any, 7}}, Tuple{Int64, Any, Any, Any, Any, Any, Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_header :: Union{Tuple{AbstractString, Int64}, Tuple{AbstractString, Int64, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_rainfall_data :: Tuple{Vector{&lt;:AbstractString}, Any, Int64}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.read_noaa_data :: Tuple{String}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.test_read_noaa_data :: Tuple{}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.calc_distance :: NTuple{4, Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.weibull_plotting_positions :: Tuple{Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.find_nearest_stations :: Union{Tuple{Any, Any}, Tuple{Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.create_return_period_range :: Union{Tuple{}, Tuple{Any}, Tuple{Any, Any}, Tuple{Any, Any, Any}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>MersenneTwister(543)</code></pre>
</div>
</div>
<div id="66" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb44"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>co2_data <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    co2_fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">&quot;logCo2.csv&quot;</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    TidierFiles.<span class="fu">read_csv</span>(co2_fname) <span class="op">|&gt;</span> DataFrame</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div><div style = "float: left;"><span>176×2 DataFrame</span></div><div style = "float: right;"><span style = "font-style: italic;">171 rows omitted</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;">
<table class="data-frame caption-top" data-quarto-postprocess="true" style="margin-bottom: 6px;">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">log_CO2</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">1849</td>
<td style="text-align: right;">5.65312</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">1850</td>
<td style="text-align: right;">5.65407</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">1851</td>
<td style="text-align: right;">5.65452</td>
</tr>
<tr class="even">
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
<td style="text-align: right;">⋮</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">175</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">6.04281</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">176</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">6.05116</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="68" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb45"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>my_stnid <span class="op">=</span> <span class="fl">780</span>  <span class="co"># Station 41-4309 (Houston WB City, TX)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>my_station <span class="op">=</span> <span class="pp">@chain</span> stations <span class="cf">begin</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(stnid <span class="op">==</span> !!my_stnid)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    first</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>my_rainfall <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(stnid <span class="op">==</span> !!my_stnid)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(date)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@full_join</span>(co2_data, <span class="st">&quot;year&quot;</span>)  <span class="co"># Join with CO2 data</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@arrange</span>(year)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>my_rainfall_nomissing <span class="op">=</span> <span class="pp">@chain</span> my_rainfall <span class="cf">begin</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@filter</span>(!<span class="fu">ismissing</span>(rainfall) <span class="op">&amp;&amp;</span> !<span class="fu">ismissing</span>(log_CO2))</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>station_time_series <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">600</span>))</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top plot: Rainfall vs Year</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Year&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Annual Max Rainfall (inches)&quot;</span>,</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Annual Maximum Rainfall at </span><span class="sc">$</span>(my_station.name)<span class="st">, TX&quot;</span>)</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> my_rainfall.year</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    rain <span class="op">=</span> <span class="fu">ustrip</span>.(u<span class="st">&quot;inch&quot;</span>, my_rainfall.rainfall)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax1, years, rain, color<span class="op">=:</span>blue)</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax1, years, rain, color<span class="op">=:</span>blue, markersize<span class="op">=</span><span class="fl">8</span>)</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Middle plot: CO2 vs Year</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">2</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Year&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;CO₂ Concentration (ppm)&quot;</span>,</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Global Mean CO₂ Concentration&quot;</span>)</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines!</span>(ax2, years, my_rainfall.log_CO2, color<span class="op">=:</span>red, linewidth<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bottom plot: Rainfall vs log(CO2)</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">&quot;log(CO₂) Concentration&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Annual Max Rainfall (inches)&quot;</span>,</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Rainfall vs log(CO₂)&quot;</span>)</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scatter!</span>(ax3, my_rainfall_nomissing.log_CO2, <span class="fu">ustrip</span>.(u<span class="st">&quot;inch&quot;</span>, my_rainfall_nomissing.rainfall), color<span class="op">=:</span>green, markersize<span class="op">=</span><span class="fl">8</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-35-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<div id="70" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb46"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>nearby_stations <span class="op">=</span> <span class="fu">find_nearest_stations</span>(my_station, stations, <span class="fl">100</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>nearby_stations</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mann_kendall_test</span>(x<span class="op">::</span><span class="dt">AbstractVector</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&quot;&quot;Mann-Kendall test for monotonic trend detection.&quot;&quot;&quot;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="fu">length</span>(x)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test statistic: sum of signs of all pairwise differences</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="fu">sum</span>(<span class="fu">sign</span>(x[j] <span class="op">-</span> x[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>(n<span class="op">-</span><span class="fl">1</span>) <span class="cf">for</span> j <span class="kw">in</span> (i<span class="op">+</span><span class="fl">1</span>)<span class="op">:</span>n)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For n&gt;10, under Null Hypothesis of no trend,</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># S is Normally distributed with mean 0 and</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># variance V = (n/18) * (n-1) * (2n+5)</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    var_S <span class="op">=</span> n <span class="op">*</span> (n <span class="op">-</span> <span class="fl">1</span>) <span class="op">*</span> (<span class="fl">2</span>n <span class="op">+</span> <span class="fl">5</span>) <span class="op">/</span> <span class="fl">18</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardized test statistic with continuity correction</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> <span class="cf">if</span> S <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>        (S <span class="op">-</span> <span class="fl">1</span>) <span class="op">/</span> <span class="fu">sqrt</span>(var_S)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elseif</span> S <span class="op">&lt;</span> <span class="fl">0</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>        (S <span class="op">+</span> <span class="fl">1</span>) <span class="op">/</span> <span class="fu">sqrt</span>(var_S)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.0</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Two-tailed p-value</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    p_value <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> <span class="fu">cdf</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">1</span>), <span class="fu">abs</span>(Z)))</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S, p_value</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>mann_kendall_test (generic function with 1 method)</code></pre>
</div>
</div>
<section id="man-kendall-result-statistics-for-task-3-part-a" class="level3" data-number="1.10">
<h3 data-number="1.10"><span class="header-section-number">1.10</span> Man kendall result statistics for task 3 , part a</h3>
<div id="72" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb48"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first compute for main station</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># add main station to the table (minimal)</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> !(my_station.stnid <span class="kw">in</span> nearby_stations.stnid)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    nearby_stations <span class="op">=</span> <span class="fu">vcat</span>(<span class="fu">DataFrame</span>(my_station), nearby_stations; cols <span class="op">=</span> <span class="op">:</span>union)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>prcp_obs <span class="op">=</span> <span class="fu">ustrip</span>.(u<span class="st">&quot;inch&quot;</span>, my_rainfall_nomissing.rainfall)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>mk_S, mk_p <span class="op">=</span> <span class="fu">mann_kendall_test</span>(prcp_obs)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    stnids <span class="op">=</span> nearby_stations.stnid</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    raw_results <span class="op">=</span> <span class="fu">map</span>(stnids) <span class="cf">do</span> stnid</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@filter</span>(stnid <span class="op">==</span> !!stnid)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>            <span class="pp">@filter</span>(!<span class="fu">ismissing</span>(rainfall))</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>        prcp <span class="op">=</span> <span class="fu">ustrip</span>.(u<span class="st">&quot;inch&quot;</span>, df.rainfall)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>        mk_S, mk_p <span class="op">=</span> <span class="fu">mann_kendall_test</span>(prcp)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> mk_S, mk_p</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    nearby_stations[!, <span class="op">:</span>mk_S]      <span class="op">=</span> <span class="fu">getindex</span>.(raw_results, <span class="fl">1</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    nearby_stations[!, <span class="op">:</span>mk_pvalue] <span class="op">=</span> <span class="fu">getindex</span>.(raw_results, <span class="fl">2</span>)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(nearby_stations, <span class="fl">5</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div><div style = "float: left;"><span>5×10 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;">
<table class="data-frame caption-top" data-quarto-postprocess="true" style="margin-bottom: 6px;">
<thead>
<tr class="header">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;">Row</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stnid</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">noaa_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">latitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">longitude</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">years_of_data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">distance_km</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mk_S</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">mk_pvalue</th>
</tr>
<tr class="subheader headerLastRow even">
<th class="rowNumber" data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold;"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="String">String</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Int64">Int64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Unitful.Quantity{Float64, 𝐋, Unitful.FreeUnits{(km,), 𝐋, nothing}}">Quantity…</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
<th style="text-align: left;" data-quarto-table-cell-role="th" title="Float64">Float64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">1</td>
<td style="text-align: right;">780</td>
<td style="text-align: left;">79-0056</td>
<td style="text-align: left;">HOUSTON WB CITY</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.7622</td>
<td style="text-align: right;">-95.3593</td>
<td style="text-align: right;">129</td>
<td style="text-align: right;">0.0 km</td>
<td style="text-align: right;">651.0</td>
<td style="text-align: right;">0.165406</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">2</td>
<td style="text-align: right;">377</td>
<td style="text-align: left;">41-4321</td>
<td style="text-align: left;">HOUSTON HEIGHTS</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.7914</td>
<td style="text-align: right;">-95.4261</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">7.22648 km</td>
<td style="text-align: right;">623.0</td>
<td style="text-align: right;">1.85426e-5</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">3</td>
<td style="text-align: right;">380</td>
<td style="text-align: left;">41-4326</td>
<td style="text-align: left;">HOUSTON-PORT</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.7456</td>
<td style="text-align: right;">-95.28</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">7.88331 km</td>
<td style="text-align: right;">14.0</td>
<td style="text-align: right;">0.807343</td>
</tr>
<tr class="even">
<td class="rowNumber" style="text-align: right; font-weight: bold;">4</td>
<td style="text-align: right;">378</td>
<td style="text-align: left;">41-4323</td>
<td style="text-align: left;">HOUSTON INDEP HTS</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.8667</td>
<td style="text-align: right;">-95.4167</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">12.8861 km</td>
<td style="text-align: right;">336.0</td>
<td style="text-align: right;">0.110627</td>
</tr>
<tr class="odd">
<td class="rowNumber" style="text-align: right; font-weight: bold;">5</td>
<td style="text-align: right;">384</td>
<td style="text-align: left;">41-4331</td>
<td style="text-align: left;">HOUSTON SPRING BRANCH</td>
<td style="text-align: left;">TX</td>
<td style="text-align: right;">29.8042</td>
<td style="text-align: right;">-95.4914</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">13.592 km</td>
<td style="text-align: right;">426.0</td>
<td style="text-align: right;">0.021454</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="74" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb49"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fig_trends <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">600</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create 1x2 layout with GeoAxis, each with colorbar to the right</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">GeoAxis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>]; source<span class="op">=</span><span class="st">&quot;+proj=latlong&quot;</span>, dest<span class="op">=</span><span class="st">&quot;+proj=merc&quot;</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Mann-Kendall S Statistic&quot;</span>, xgridvisible<span class="op">=</span><span class="cn">false</span>, ygridvisible<span class="op">=</span><span class="cn">false</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        xticksvisible<span class="op">=</span><span class="cn">false</span>, yticksvisible<span class="op">=</span><span class="cn">false</span>, xticklabelsvisible<span class="op">=</span><span class="cn">false</span>, yticklabelsvisible<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">GeoAxis</span>(fig[<span class="fl">1</span>, <span class="fl">3</span>]; source<span class="op">=</span><span class="st">&quot;+proj=latlong&quot;</span>, dest<span class="op">=</span><span class="st">&quot;+proj=merc&quot;</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Mann-Kendall p-values&quot;</span>, xgridvisible<span class="op">=</span><span class="cn">false</span>, ygridvisible<span class="op">=</span><span class="cn">false</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        xticksvisible<span class="op">=</span><span class="cn">false</span>, yticksvisible<span class="op">=</span><span class="cn">false</span>, xticklabelsvisible<span class="op">=</span><span class="cn">false</span>, yticklabelsvisible<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add background layers for each axis</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    counties <span class="op">=</span> GeoMakie.<span class="fu">naturalearth</span>(<span class="st">&quot;admin_2_counties_lakes&quot;</span>, <span class="fl">10</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax <span class="kw">in</span> [ax1, ax2]</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add US counties (white with gray borders)</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">poly!</span>(ax, counties.geometry; strokecolor<span class="op">=:</span>lightgray, strokewidth<span class="op">=</span><span class="fl">1.5</span>, color<span class="op">=:</span>white)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set Texas extent</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    Δ <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax <span class="kw">in</span> [ax1, ax2]</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlims!</span>(ax, <span class="fu">minimum</span>(nearby_stations.longitude) <span class="op">-</span> Δ, <span class="fu">maximum</span>(nearby_stations.longitude) <span class="op">+</span> Δ)</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ylims!</span>(ax, <span class="fu">minimum</span>(nearby_stations.latitude) <span class="op">-</span> Δ, <span class="fu">maximum</span>(nearby_stations.latitude) <span class="op">+</span> Δ)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot data with appropriate colormaps and individual colorbars</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>    s1 <span class="op">=</span> <span class="fu">scatter!</span>(ax1, nearby_stations.longitude, nearby_stations.latitude,</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>nearby_stations.mk_S, colormap<span class="op">=:</span>RdBu, markersize<span class="op">=</span><span class="fl">18</span>)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Colorbar</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], s1, label<span class="op">=</span><span class="st">&quot;S Statistic&quot;</span>)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    s2 <span class="op">=</span> <span class="fu">scatter!</span>(ax2, nearby_stations.longitude, nearby_stations.latitude,</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span>nearby_stations.mk_pvalue, colormap<span class="op">=:</span>viridis, markersize<span class="op">=</span><span class="fl">18</span>)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Colorbar</span>(fig[<span class="fl">1</span>, <span class="fl">4</span>], s2, label<span class="op">=</span><span class="st">&quot;p-value&quot;</span>)</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-38-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
</section>
<section id="task-3-part-c-implement-two-models-that-allow-different-gev-parameters-to-vary-with-co₂" class="level2" data-number="2">
<h2 data-number="2"><span class="header-section-number">2</span> Task 3, part c, implement two models that allow different GEV parameters to vary with CO₂:</h2>
<div id="76" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb50"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">nonstationary_gev_model1</span>(y, x)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 1: μ(x) = α_μ + β_μ*x where x = log(CO2)</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    α_μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">3.0</span>, <span class="fl">1.0</span>)    <span class="co"># baseline location parameter</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    β_μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.5</span>)    <span class="co"># location trend parameter (inches per log(ppm))</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    log_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.5</span>)  <span class="co"># log-scale parameter</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.1</span>)      <span class="co"># shape parameter</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>(log_σ)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Location parameter varies with CO2</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(y)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>        x_centered <span class="op">=</span> x[i] <span class="op">-</span> <span class="fu">log</span>(<span class="fl">380</span>)  <span class="co"># center around ~380 ppm</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        μ_x <span class="op">=</span> α_μ <span class="op">+</span> β_μ <span class="op">*</span> x_centered</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>        dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_x, σ, ξ)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        y[i] <span class="op">~</span> dist</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">nonstationary_gev_model2</span>(y, x)</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 2: μ(x) = α_μ + β_μ*x, σ(x) = α_σ + β_σ*x</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    α_μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">4.0</span>, <span class="fl">1.5</span>)      <span class="co"># baseline location parameter</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    β_μ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.5</span>)      <span class="co"># location trend parameter</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    α_σ <span class="op">~</span> <span class="fu">LogNormal</span>(<span class="fl">0.0</span>, <span class="fl">1.0</span>)   <span class="co"># baseline scale parameter</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    β_σ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.2</span>)      <span class="co"># scale trend parameter (small prior)</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)        <span class="co"># shape parameter</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(y)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>        x_centered <span class="op">=</span> x[i] <span class="op">-</span> <span class="fu">log</span>(<span class="fl">380</span>)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>        μ_x <span class="op">=</span> α_μ <span class="op">+</span> β_μ <span class="op">*</span> x_centered</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>        σ_x <span class="op">=</span> α_σ <span class="op">+</span> β_σ <span class="op">*</span> x_centered</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure positive scale parameter</span></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> σ_x <span class="op">&gt;</span> <span class="fl">0.1</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>            dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_x, σ_x, ξ)</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>            y[i] <span class="op">~</span> dist</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>            Turing.<span class="pp">@addlogprob</span>!(<span class="op">-</span><span class="cn">Inf</span>)</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>nonstationary_gev_model2 (generic function with 2 methods)</code></pre>
</div>
</div>
<div id="78" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb52"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">include</span>(<span class="fu">joinpath</span>(<span class="st">&quot;D:</span><span class="sc">\\</span><span class="st">FALL 2025</span><span class="sc">\\</span><span class="st">CEVE 543</span><span class="sc">\\</span><span class="st">assignment</span><span class="sc">\\</span><span class="st">prblmset1</span><span class="sc">\\</span><span class="st">New folder&quot;</span>, <span class="st">&quot;util.jl&quot;</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">&quot;ArviZ&quot;</span>)    <span class="co"># install once in the current environment</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ArviZ</span>         <span class="co"># load it</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Pkg</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Pkg</span>.<span class="fu">add</span>(<span class="st">&quot;NCDatasets&quot;</span>)   </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> <span class="fu">ustrip</span>.(u<span class="st">&quot;inch&quot;</span>, my_rainfall_nomissing.rainfall)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>x_obs <span class="op">=</span> my_rainfall_nomissing.log_CO2  <span class="co"># x = log(CO2)</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the two models</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&quot;Location trend&quot;</span>, <span class="fu">nonstationary_gev_model1</span>(y_obs, x_obs)),</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&quot;Location + Scale trends&quot;</span>, <span class="fu">nonstationary_gev_model2</span>(y_obs, x_obs)),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample from posteriors and check diagnostics</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>posterior_results <span class="op">=</span> []</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (name, model) <span class="kw">in</span> models</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">&quot;nonstat_</span><span class="sc">$</span>(<span class="fu">replace</span>(name, <span class="st">&quot; &quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;_&quot;</span>))<span class="st">.nc&quot;</span>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># either load or sample</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    idata <span class="op">=</span> <span class="fu">load_or_sample</span>(fname, model; overwrite<span class="op">=</span>overwrite, samples_per_chain<span class="op">=</span><span class="fl">1000</span>)</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Save to NetCDF (explicit ArviZ call) ---</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    ArviZ.<span class="fu">to_netcdf</span>(idata, fname)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep results</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push!</span>(posterior_results, (name<span class="op">=</span>name, idata<span class="op">=</span>idata))</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># diagnostics</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">&quot;=== Diagnostics for </span><span class="sc">$</span>name<span class="st"> ===&quot;</span>)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(ArviZ.<span class="fu">summarize</span>(idata))</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_parts :: Union{Tuple{Int64, Vararg{Any, 6}}, Tuple{Int64, Any, Any, Any, Any, Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_parts :: Union{Tuple{Int64, Vararg{Any, 7}}, Tuple{Int64, Any, Any, Any, Any, Any, Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_station_header :: Union{Tuple{AbstractString, Int64}, Tuple{AbstractString, Int64, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.parse_rainfall_data :: Tuple{Vector{&lt;:AbstractString}, Any, Int64}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.read_noaa_data :: Tuple{String}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.test_read_noaa_data :: Tuple{}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.calc_distance :: NTuple{4, Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.weibull_plotting_positions :: Tuple{Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.find_nearest_stations :: Union{Tuple{Any, Any}, Tuple{Any, Any, Int64}}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.add_return_level_curve! :: Tuple{Any, Any, Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.ReturnLevelPrior :: Union{}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.posterior_mean_curve! :: Tuple{Any, Vector{&lt;:Distributions.Distribution}, Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.posterior_bands! :: Tuple{Any, Vector{&lt;:Distributions.Distribution}, Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-yellow-fg ansi-bold">┌ </span><span class="ansi-yellow-fg ansi-bold">Warning: </span>Replacing docs for `Main.Notebook.traceplot! :: Tuple{Any, Any, Any}` in module `Main.Notebook`
<span class="ansi-yellow-fg ansi-bold">└ </span><span class="ansi-bright-black-fg">@ Base.Docs docs\Docs.jl:243</span>
<span class="ansi-green-fg ansi-bold">   Resolving</span> package versions...
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\prblmset1\Project.toml`
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\prblmset1\Manifest.toml`
<span class="ansi-green-fg ansi-bold">   Resolving</span> package versions...
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\prblmset1\Project.toml`
<span class="ansi-green-fg ansi-bold">  No Changes</span> to `D:\FALL 2025\CEVE 543\assignment\prblmset1\Manifest.toml`
<span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Loaded cached samples from D:\FALL 2025\CEVE 543\assignment\prblmset1\nonstat_Location_trend.nc
=== Diagnostics for Location trend ===
<span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Loaded cached samples from D:\FALL 2025\CEVE 543\assignment\prblmset1\nonstat_Location_+_Scale_trends.nc
=== Diagnostics for Location + Scale trends ===
</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<table class="caption-top" data-quarto-postprocess="true">
<caption>SummaryStats</caption>
<thead>
<tr class="header headerLastRow">
<th class="rowLabel" data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eti89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_tail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_bulk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rhat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">β_μ</td>
<td style="text-align: right;">0.212</td>
<td style="text-align: right;">0.463</td>
<td style="text-align: left;">-0.535 .. 0.951</td>
<td style="text-align: right;">11087</td>
<td style="text-align: right;">12180</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0042</td>
<td style="text-align: right;">0.0034</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">ξ</td>
<td style="text-align: right;">0.1559</td>
<td style="text-align: right;">0.0543</td>
<td style="text-align: left;">0.0712 .. 0.245</td>
<td style="text-align: right;">9900</td>
<td style="text-align: right;">12376</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00049</td>
<td style="text-align: right;">0.00044</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ</td>
<td style="text-align: right;">3.343</td>
<td style="text-align: right;">0.141</td>
<td style="text-align: left;">3.12 .. 3.57</td>
<td style="text-align: right;">10719</td>
<td style="text-align: right;">10861</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0013</td>
<td style="text-align: right;">0.0011</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ</td>
<td style="text-align: right;">0.193</td>
<td style="text-align: right;">0.081</td>
<td style="text-align: left;">0.0661 .. 0.324</td>
<td style="text-align: right;">9961</td>
<td style="text-align: right;">11611</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00075</td>
<td style="text-align: right;">0.00064</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<table class="caption-top" data-quarto-postprocess="true">
<caption>SummaryStats</caption>
<thead>
<tr class="header headerLastRow">
<th class="rowLabel" data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eti89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_tail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_bulk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rhat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">β_μ</td>
<td style="text-align: right;">0.234</td>
<td style="text-align: right;">0.465</td>
<td style="text-align: left;">-0.520 .. 0.974</td>
<td style="text-align: right;">11060</td>
<td style="text-align: right;">14427</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0039</td>
<td style="text-align: right;">0.0036</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_σ</td>
<td style="text-align: right;">1.224</td>
<td style="text-align: right;">0.105</td>
<td style="text-align: left;">1.07 .. 1.40</td>
<td style="text-align: right;">10076</td>
<td style="text-align: right;">13928</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00089</td>
<td style="text-align: right;">0.00086</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ</td>
<td style="text-align: right;">3.342</td>
<td style="text-align: right;">0.143</td>
<td style="text-align: left;">3.12 .. 3.57</td>
<td style="text-align: right;">11060</td>
<td style="text-align: right;">12834</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0013</td>
<td style="text-align: right;">0.0012</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">ξ</td>
<td style="text-align: right;">0.1839</td>
<td style="text-align: right;">0.0563</td>
<td style="text-align: left;">0.0969 .. 0.277</td>
<td style="text-align: right;">10798</td>
<td style="text-align: right;">15934</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00045</td>
<td style="text-align: right;">0.00045</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">β_σ</td>
<td style="text-align: right;">0.039</td>
<td style="text-align: right;">0.196</td>
<td style="text-align: left;">-0.271 .. 0.353</td>
<td style="text-align: right;">11676</td>
<td style="text-align: right;">16593</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0015</td>
<td style="text-align: right;">0.0017</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="80" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb53"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Traceplots for Model 1</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>model1_traceplots <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">600</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    param_names <span class="op">=</span> [<span class="op">:</span>α_μ, <span class="op">:</span>β_μ, <span class="op">:</span>log_σ, <span class="op">:</span>ξ]</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, param) <span class="kw">in</span> <span class="fu">enumerate</span>(param_names)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> <span class="fu">Axis</span>(fig[i, <span class="fl">1</span>], xlabel<span class="op">=</span>i <span class="op">==</span> <span class="fu">length</span>(param_names) ? <span class="st">&quot;Iteration&quot;</span> <span class="op">:</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>            ylabel<span class="op">=</span><span class="fu">string</span>(param), title<span class="op">=</span>i <span class="op">==</span> <span class="fl">1</span> ? <span class="st">&quot;Model 1 (Location Trend)&quot;</span> <span class="op">:</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">traceplot!</span>(ax, posterior_results[<span class="fl">1</span>].idata, param)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-41-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="82" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb54"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Traceplots for Model 2</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>model2_traceplots <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">800</span>))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    param_names <span class="op">=</span> [<span class="op">:</span>α_μ, <span class="op">:</span>β_μ, <span class="op">:</span>α_σ, <span class="op">:</span>β_σ, <span class="op">:</span>ξ]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, param) <span class="kw">in</span> <span class="fu">enumerate</span>(param_names)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> <span class="fu">Axis</span>(fig[i, <span class="fl">1</span>], xlabel<span class="op">=</span>i <span class="op">==</span> <span class="fu">length</span>(param_names) ? <span class="st">&quot;Iteration&quot;</span> <span class="op">:</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>            ylabel<span class="op">=</span><span class="fu">string</span>(param), title<span class="op">=</span>i <span class="op">==</span> <span class="fl">1</span> ? <span class="st">&quot;Model 2 (Location + Scale Trends)&quot;</span> <span class="op">:</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">traceplot!</span>(ax, posterior_results[<span class="fl">2</span>].idata, param)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-42-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="84" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb55"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">####extracting GEV dist (lab 5, 3.4)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: Location trend only</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">extract_model1_gevs</span>(idata, x)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    x_centered <span class="op">=</span> x <span class="op">-</span> <span class="fu">log</span>(<span class="fl">380</span>)  <span class="co"># center around ~380 ppm</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    α_μ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>α_μ])</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    β_μ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>β_μ])</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">exp</span>.(<span class="fu">Array</span>(idata.posterior[<span class="op">:</span>log_σ]))</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>ξ])</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    μ_x <span class="op">=</span> α_μ <span class="op">.+</span> β_μ <span class="op">.*</span> x_centered</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(μ_x, σ, ξ))</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: Location + Scale trends</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">extract_model2_gevs</span>(idata, x)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    x_centered <span class="op">=</span> x <span class="op">-</span> <span class="fu">log</span>(<span class="fl">380</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    α_μ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>α_μ])</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    β_μ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>β_μ])</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    α_σ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>α_σ])</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    β_σ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>β_σ])</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    ξ <span class="op">=</span> <span class="fu">Array</span>(idata.posterior[<span class="op">:</span>ξ])</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    μ_x <span class="op">=</span> α_μ <span class="op">.+</span> β_μ <span class="op">.*</span> x_centered</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    σ_x <span class="op">=</span> α_σ <span class="op">.+</span> β_σ <span class="op">.*</span> x_centered</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out negative scale parameters</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    valid <span class="op">=</span> σ_x <span class="op">.&gt;</span> <span class="fl">0.1</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vec</span>(<span class="fu">GeneralizedExtremeValue</span>.(μ_x[valid], σ_x[valid], ξ[valid]))</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>extract_model2_gevs (generic function with 1 method)</code></pre>
</div>
</div>
<div id="86" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb57"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">###extracting GEV for 1950 and 2025</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract data for each model</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>model1_name, model1_idata <span class="op">=</span> posterior_results[<span class="fl">1</span>].name, posterior_results[<span class="fl">1</span>].idata</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>model2_name, model2_idata <span class="op">=</span> posterior_results[<span class="fl">2</span>].name, posterior_results[<span class="fl">2</span>].idata</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Approximate CO2 levels (x = log(CO2))</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>x_1950 <span class="op">=</span> co2_data.log_CO2[co2_data.year<span class="op">.==</span><span class="fl">1950</span>][<span class="fl">1</span>]  <span class="co"># ~310 ppm in 1950</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>x_2025 <span class="op">=</span> co2_data.log_CO2[co2_data.year<span class="op">.==</span><span class="fl">2024</span>][<span class="fl">1</span>]  <span class="co"># ~425 ppm projected for 2025</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract GEV distributions for both time periods</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>gevs_1950 <span class="op">=</span> [</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_model1_gevs</span>(model1_idata, x_1950),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_model2_gevs</span>(model2_idata, x_1950),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>gevs_2025 <span class="op">=</span> [</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_model1_gevs</span>(model1_idata, x_2025),</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_model2_gevs</span>(model2_idata, x_2025),</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>2-element Vector{Vector{GeneralizedExtremeValue{Float64}}}:
 [Distributions.GeneralizedExtremeValue{Float64}(μ=3.6869014164063056, σ=1.1141947259628862, ξ=0.15142830444094812), Distributions.GeneralizedExtremeValue{Float64}(μ=3.6869014164063056, σ=1.1141947259628862, ξ=0.15142830444094812), Distributions.GeneralizedExtremeValue{Float64}(μ=3.6869014164063056, σ=1.1141947259628862, ξ=0.15142830444094812), Distributions.GeneralizedExtremeValue{Float64}(μ=3.791674806688632, σ=1.1635166818327418, ξ=0.13331510554657724), Distributions.GeneralizedExtremeValue{Float64}(μ=3.2381124835399286, σ=1.271828957287171, ξ=0.1859936351863539), Distributions.GeneralizedExtremeValue{Float64}(μ=3.4651900951193957, σ=1.29992727744411, ξ=0.15065605588479034), Distributions.GeneralizedExtremeValue{Float64}(μ=3.470366256816892, σ=1.4611245264132173, ξ=0.23065249188830744), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3350009729390004, σ=1.015779514529208, ξ=0.07969982578913588), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3494012458492968, σ=1.1295897047910295, ξ=0.11323750183949804), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3011589788544824, σ=1.2501091400081128, ξ=0.21906305862127412)  …  Distributions.GeneralizedExtremeValue{Float64}(μ=3.3344472016494593, σ=1.2640060844816612, ξ=0.1510835653649076), Distributions.GeneralizedExtremeValue{Float64}(μ=3.343621671541084, σ=1.1386607454660587, ξ=0.15902417660597276), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3900915851575166, σ=1.2163389886977145, ξ=0.14151424214891825), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3808957669285338, σ=1.1727517704038504, ξ=0.18782832405828637), Distributions.GeneralizedExtremeValue{Float64}(μ=3.535713176017228, σ=1.1890797280738266, ξ=0.21646353257800166), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3797461078684, σ=1.1617601061092082, ξ=0.19083205034962297), Distributions.GeneralizedExtremeValue{Float64}(μ=3.2980449416160793, σ=1.194548204983476, ξ=0.09186590109110207), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3107370784174615, σ=1.1927574820903932, ξ=0.12977598311019312), Distributions.GeneralizedExtremeValue{Float64}(μ=3.5193736699565927, σ=1.1598787676947173, ξ=0.18562771469689662), Distributions.GeneralizedExtremeValue{Float64}(μ=3.365629330802954, σ=1.2263431696605782, ξ=0.11403761588982449)]
 [Distributions.GeneralizedExtremeValue{Float64}(μ=3.243336572091818, σ=1.1459404956368897, ξ=0.16159249963806438), Distributions.GeneralizedExtremeValue{Float64}(μ=3.0111722901668685, σ=1.1474519270957115, ξ=0.1892977150014744), Distributions.GeneralizedExtremeValue{Float64}(μ=3.1746710350612473, σ=1.1490536403411973, ξ=0.23965611237474957), Distributions.GeneralizedExtremeValue{Float64}(μ=3.265442300408962, σ=1.11873872702865, ξ=0.17449488762254012), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3645000128938953, σ=1.057585142570059, ξ=0.11700341576777483), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3899951245596895, σ=1.227773363284233, ξ=0.09689528136900377), Distributions.GeneralizedExtremeValue{Float64}(μ=3.1757497809262336, σ=1.3484814315643112, ξ=0.17506232700499186), Distributions.GeneralizedExtremeValue{Float64}(μ=3.1757497809262336, σ=1.3484814315643112, ξ=0.17506232700499186), Distributions.GeneralizedExtremeValue{Float64}(μ=3.3355173344881215, σ=1.274573043773628, ξ=0.17228915827797392), Distributions.GeneralizedExtremeValue{Float64}(μ=3.4159333138571633, σ=1.1365906335129294, ξ=0.12861675579182455)  …  Distributions.GeneralizedExtremeValue{Float64}(μ=3.157039806736201, σ=1.2870633623390628, ξ=0.20860446049595638), Distributions.GeneralizedExtremeValue{Float64}(μ=3.664812948649506, σ=1.1399860237451778, ξ=0.21307250816827183), Distributions.GeneralizedExtremeValue{Float64}(μ=3.523213753972118, σ=1.2466101425448852, ξ=0.14972317625701492), Distributions.GeneralizedExtremeValue{Float64}(μ=3.610398340705969, σ=1.4378362226443488, ξ=0.16467697128436118), Distributions.GeneralizedExtremeValue{Float64}(μ=3.584897659068999, σ=1.4616112737541176, ξ=0.21699705237958178), Distributions.GeneralizedExtremeValue{Float64}(μ=3.5435580333927605, σ=1.3863278999737705, ξ=0.23827093969535168), Distributions.GeneralizedExtremeValue{Float64}(μ=3.5100893725107114, σ=1.3342406705816452, ξ=0.1857661549805957), Distributions.GeneralizedExtremeValue{Float64}(μ=3.55133290970257, σ=1.3195561524204156, ξ=0.278030481071953), Distributions.GeneralizedExtremeValue{Float64}(μ=3.4399235850089265, σ=1.1942031666378465, ξ=0.17788849321942019), Distributions.GeneralizedExtremeValue{Float64}(μ=3.1628347971389466, σ=1.0575329024352031, ξ=0.1796060280063584)]</code></pre>
</div>
</div>
<section id="task3-part-5---generate-return-level-plots-showing-how-extreme-events-change-over-time-under-your-models" class="level3" data-number="2.1">
<h3 data-number="2.1"><span class="header-section-number">2.1</span> Task3, part 5 - Generate return level plots showing how extreme events change over time under your models</h3>
<div id="88" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb59"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co">###task3,part5-model comparison and uncertainty-lab 5, 3.5</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive comparison: 1950 vs 2025 across both models</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>fig_comprehensive <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1000</span>, <span class="fl">700</span>))</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">100</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    xticks <span class="op">=</span> [<span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>]</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top row: 1950 vs 2025 comparison for each model (adjust column widths)</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Location Trend Model&quot;</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Location + Scale Trends Model&quot;</span>, xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make columns equal width</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colsize!</span>(fig.layout, <span class="fl">1</span>, <span class="fu">Relative</span>(<span class="fl">0.5</span>))</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colsize!</span>(fig.layout, <span class="fl">2</span>, <span class="fu">Relative</span>(<span class="fl">0.5</span>))</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    top_axes <span class="op">=</span> [ax1, ax2]</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, (ax, gevs_50, gevs_25)) <span class="kw">in</span> <span class="fu">enumerate</span>(<span class="fu">zip</span>(top_axes, gevs_1950, gevs_2025))</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_bands!</span>(ax, gevs_50, rts; ci<span class="op">=</span><span class="fl">0.90</span>, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.3</span>))</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_mean_curve!</span>(ax, gevs_50, rts; color<span class="op">=:</span>blue, linewidth<span class="op">=</span><span class="fl">2</span>, label<span class="op">=</span><span class="st">&quot;1950&quot;</span>)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_bands!</span>(ax, gevs_25, rts; ci<span class="op">=</span><span class="fl">0.90</span>, color<span class="op">=</span>(<span class="op">:</span>red, <span class="fl">0.3</span>))</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_mean_curve!</span>(ax, gevs_25, rts; color<span class="op">=:</span>red, linewidth<span class="op">=</span><span class="fl">2</span>, label<span class="op">=</span><span class="st">&quot;2025&quot;</span>)</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="fl">1</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">axislegend</span>(ax, position<span class="op">=:</span>rb)</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bottom: Direct model comparison for 2025</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>    ax3 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>,</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Model Comparison for 2025 (Note: Models Show Similar Behavior)&quot;</span>,</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>        xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="op">:</span>blue, <span class="op">:</span>red]</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="st">&quot;Location Trend&quot;</span>, <span class="st">&quot;Location + Scale&quot;</span>]</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, (gevs, color, label)) <span class="kw">in</span> <span class="fu">enumerate</span>(<span class="fu">zip</span>(gevs_2025, colors, labels))</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_bands!</span>(ax3, gevs, rts; ci<span class="op">=</span><span class="fl">0.68</span>, color<span class="op">=</span>(color, <span class="fl">0.3</span>))</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">posterior_mean_curve!</span>(ax3, gevs, rts; color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="fl">2</span>, label<span class="op">=</span>label)</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax3, position<span class="op">=:</span>lt)</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">linkyaxes!</span>(top_axes<span class="op">...</span>)</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-45-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="90" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb60"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig_rl100_comparison <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">400</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    titles <span class="op">=</span> [<span class="st">&quot;Location Trend&quot;</span>, <span class="st">&quot;Location + Scale&quot;</span>]</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, i], xlabel<span class="op">=</span><span class="st">&quot;100-year RL (inches)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Count&quot;</span>, title<span class="op">=</span>titles[i])</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate 100-year return levels</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>        rl_1950 <span class="op">=</span> [<span class="fu">quantile</span>(gev, <span class="fl">0.99</span>) for gev <span class="kw">in</span> gevs_1950[i]]</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        rl_2025 <span class="op">=</span> [<span class="fu">quantile</span>(gev, <span class="fl">0.99</span>) for gev <span class="kw">in</span> gevs_2025[i]]</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot histograms</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hist!</span>(ax, rl_1950, bins<span class="op">=</span><span class="fl">25</span>, color<span class="op">=</span>(<span class="op">:</span>purple, <span class="fl">0.5</span>), label<span class="op">=</span><span class="st">&quot;1950&quot;</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">hist!</span>(ax, rl_2025, bins<span class="op">=</span><span class="fl">25</span>, color<span class="op">=</span>(<span class="op">:</span>orange, <span class="fl">0.5</span>), label<span class="op">=</span><span class="st">&quot;2025&quot;</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>        i <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;&amp;</span> <span class="fu">axislegend</span>(ax, position<span class="op">=:</span>rt)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-46-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="92" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb61"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">##### task 4, part c-   Implement your chosen regional model where some parameters are shared across stations while others remain station-specific</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>analysis_stations <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> my_station.longitude</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> my_station.latitude</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@chain</span> nearby_stations <span class="cf">begin</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@filter</span>(years_of_data <span class="op">&gt;=</span> <span class="fl">40</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@mutate</span>(distance <span class="op">=</span> <span class="fu">calc_distance</span>(!!lat, !!lon, latitude, longitude))</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@arrange</span>(distance)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">first</span>(<span class="fl">8</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>analysis_stnids <span class="op">=</span> analysis_stations.stnid</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>8-element Vector{Int64}:
 780
 782
 378
 377
 312
 770
 604
 387</code></pre>
</div>
</div>
<div id="94" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb63"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>years_vec, rainfall_matrix <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    rainfall_matrix_data <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@filter</span>(<span class="fu">in</span>(stnid, !!analysis_stnids))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@mutate</span>(rainfall_inch <span class="op">=</span> <span class="fu">ifelse</span>(<span class="fu">ismissing</span>(rainfall), <span class="cn">missing</span>, <span class="fu">ustrip</span>(u<span class="st">&quot;inch&quot;</span>, rainfall)))</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span>(year, stnid, rainfall_inch)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@pivot_wider</span>(names_from <span class="op">=</span> stnid, values_from <span class="op">=</span> rainfall_inch)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@arrange</span>(year)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> rainfall_matrix_data.year</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    matrix <span class="op">=</span> <span class="fu">Matrix</span>(rainfall_matrix_data[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="kw">end</span>])</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    years, matrix</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>([1889, 1890, 1891, 1892, 1893, 1894, 1895, 1896, 1897, 1898  …  2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017], Union{Missing, Float64}[missing missing … 3.18 missing; missing missing … 4.75 missing; … ; 12.35 missing … 5.69 9.79; 7.75 missing … 14.7 16.3])</code></pre>
</div>
</div>
<div id="96" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb65"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare matrices for regional model, lab 5- 4.2</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>y_matrix, x_vector <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get rainfall matrix: [year, station]</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    rainfall_wide <span class="op">=</span> <span class="pp">@chain</span> rainfall_data <span class="cf">begin</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@filter</span>(<span class="fu">in</span>(stnid, !!analysis_stnids))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@mutate</span>(rainfall_inch <span class="op">=</span> <span class="fu">ustrip</span>(u<span class="st">&quot;inch&quot;</span>, rainfall))</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span>(year, stnid, rainfall_inch)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@pivot_wider</span>(names_from <span class="op">=</span> stnid, values_from <span class="op">=</span> rainfall_inch)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@arrange</span>(year)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract years and matrix</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> rainfall_wide.year</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    y_mat <span class="op">=</span> <span class="fu">Matrix</span>(rainfall_wide[<span class="op">:</span>, <span class="fl">2</span><span class="op">:</span><span class="kw">end</span>])  <span class="co"># Drop year column</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get x vector (log CO2) for the same years</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    x_vec <span class="op">=</span> <span class="pp">@chain</span> co2_data <span class="cf">begin</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@filter</span>(<span class="fu">in</span>(year, !!years))</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@arrange</span>(year)</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>        <span class="pp">@select</span>(log_CO2)</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    y_mat, x_vec.log_CO2</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(Union{Missing, Float64}[missing missing … 3.18 missing; missing missing … 4.75 missing; … ; 12.35 missing … 5.69 9.79; 7.75 missing … 14.7 16.3], [5.677130443658775, 5.678567225515137, 5.679933672624212, 5.681025487533585, 5.681707267004343, 5.6820139161830525, 5.68235452724258, 5.682831187903269, 5.683545753154764, 5.684701586843409  …  5.955401177628522, 5.960083523128392, 5.966407388912268, 5.970881240160727, 5.9764926082260175, 5.983274852924057, 5.988491381628566, 5.993992598890556, 6.002435396658721, 6.0082171847736525])</code></pre>
</div>
</div>
<div id="98" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb67"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">###lab 5,4.3 regional model implementation</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">regional_nonstationary_gev</span>(y_matrix, x_vector)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    n_years, n_stations <span class="op">=</span> <span class="fu">size</span>(y_matrix)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Regional parameters (shared across all stations)</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    β_region <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">2.0</span>)          <span class="co"># Regional trend (inches per log(ppm))</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    ξ_region <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0.0</span>, <span class="fl">0.2</span>)          <span class="co"># Regional shape parameter</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Station-specific parameters (independent for each station)</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    α_μ_stations <span class="op">~</span> <span class="fu">MvNormal</span>(<span class="fu">fill</span>(<span class="fl">3.0</span>, n_stations), I <span class="op">*</span> <span class="fl">2.0</span>)  <span class="co"># Baseline location for each station</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    log_σ_stations <span class="op">~</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(n_stations), I <span class="op">*</span> <span class="fl">0.5</span>)    <span class="co"># Scale parameter for each station</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    σ_stations <span class="op">=</span> <span class="fu">exp</span>.(log_σ_stations)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data likelihood - loop over matrix, skip missing values</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_years</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>        x_centered <span class="op">=</span> x_vector[i] <span class="op">-</span> <span class="fu">log</span>(<span class="fl">380</span>)  <span class="co"># Center x around ~380 ppm CO2</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_stations</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> !<span class="fu">ismissing</span>(y_matrix[i, j])</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>                μ_ij <span class="op">=</span> α_μ_stations[j] <span class="op">+</span> β_region <span class="op">*</span> x_centered</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>                dist <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>(μ_ij, σ_stations[j], ξ_region)</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>                y_matrix[i, j] <span class="op">~</span> dist</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regional model with diagnostics</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>regional_idata <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>    regional_fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">&quot;regional_nonstat.nc&quot;</span>)</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>    regional_model <span class="op">=</span> <span class="fu">regional_nonstationary_gev</span>(y_matrix, x_vector)</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    overwrite <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>    idata <span class="op">=</span> <span class="fu">load_or_sample</span>(regional_fname, regional_model; overwrite<span class="op">=</span>overwrite, samples_per_chain<span class="op">=</span><span class="fl">1500</span>)</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check diagnostics immediately after fitting</span></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">&quot;=== Regional Model Diagnostics ===&quot;</span>)</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">display</span>(ArviZ.<span class="fu">summarize</span>(idata))</span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>    idata</span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg ansi-bold">[ </span><span class="ansi-cyan-fg ansi-bold">Info: </span>Loaded cached samples from D:\FALL 2025\CEVE 543\assignment\prblmset1\regional_nonstat.nc
=== Regional Model Diagnostics ===
</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<table class="caption-top" data-quarto-postprocess="true">
<caption>SummaryStats</caption>
<thead>
<tr class="header headerLastRow">
<th class="rowLabel" data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">eti89</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_tail</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ess_bulk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rhat</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mcse_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">ξ_region</td>
<td style="text-align: right;">0.2195</td>
<td style="text-align: right;">0.0345</td>
<td style="text-align: left;">0.166 .. 0.276</td>
<td style="text-align: right;">18462</td>
<td style="text-align: right;">26443</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00021</td>
<td style="text-align: right;">0.00022</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[1]</td>
<td style="text-align: right;">3.464</td>
<td style="text-align: right;">0.179</td>
<td style="text-align: left;">3.18 .. 3.75</td>
<td style="text-align: right;">17614</td>
<td style="text-align: right;">20414</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0013</td>
<td style="text-align: right;">0.0011</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[2]</td>
<td style="text-align: right;">3.601</td>
<td style="text-align: right;">0.190</td>
<td style="text-align: left;">3.30 .. 3.91</td>
<td style="text-align: right;">18736</td>
<td style="text-align: right;">22817</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0013</td>
<td style="text-align: right;">0.0011</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[3]</td>
<td style="text-align: right;">3.545</td>
<td style="text-align: right;">0.180</td>
<td style="text-align: left;">3.26 .. 3.83</td>
<td style="text-align: right;">18913</td>
<td style="text-align: right;">21408</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0012</td>
<td style="text-align: right;">0.0011</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[4]</td>
<td style="text-align: right;">3.580</td>
<td style="text-align: right;">0.233</td>
<td style="text-align: left;">3.22 .. 3.96</td>
<td style="text-align: right;">17554</td>
<td style="text-align: right;">22551</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0016</td>
<td style="text-align: right;">0.0015</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[5]</td>
<td style="text-align: right;">2.958</td>
<td style="text-align: right;">0.193</td>
<td style="text-align: left;">2.66 .. 3.28</td>
<td style="text-align: right;">17443</td>
<td style="text-align: right;">19620</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0014</td>
<td style="text-align: right;">0.0012</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[6]</td>
<td style="text-align: right;">3.688</td>
<td style="text-align: right;">0.177</td>
<td style="text-align: left;">3.41 .. 3.98</td>
<td style="text-align: right;">19133</td>
<td style="text-align: right;">22051</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0012</td>
<td style="text-align: right;">0.0010</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[7]</td>
<td style="text-align: right;">3.402</td>
<td style="text-align: right;">0.151</td>
<td style="text-align: left;">3.16 .. 3.65</td>
<td style="text-align: right;">18559</td>
<td style="text-align: right;">18141</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0011</td>
<td style="text-align: right;">0.00089</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">α_μ_stations[8]</td>
<td style="text-align: right;">3.785</td>
<td style="text-align: right;">0.229</td>
<td style="text-align: left;">3.43 .. 4.16</td>
<td style="text-align: right;">16507</td>
<td style="text-align: right;">23346</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0015</td>
<td style="text-align: right;">0.0015</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[1]</td>
<td style="text-align: right;">0.385</td>
<td style="text-align: right;">0.097</td>
<td style="text-align: left;">0.232 .. 0.542</td>
<td style="text-align: right;">19107</td>
<td style="text-align: right;">21776</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00066</td>
<td style="text-align: right;">0.00055</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[2]</td>
<td style="text-align: right;">0.187</td>
<td style="text-align: right;">0.122</td>
<td style="text-align: left;">-0.00510 .. 0.385</td>
<td style="text-align: right;">20268</td>
<td style="text-align: right;">27551</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00074</td>
<td style="text-align: right;">0.00073</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[3]</td>
<td style="text-align: right;">0.278</td>
<td style="text-align: right;">0.110</td>
<td style="text-align: left;">0.104 .. 0.456</td>
<td style="text-align: right;">18501</td>
<td style="text-align: right;">24555</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00070</td>
<td style="text-align: right;">0.00067</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[4]</td>
<td style="text-align: right;">0.493</td>
<td style="text-align: right;">0.114</td>
<td style="text-align: left;">0.314 .. 0.676</td>
<td style="text-align: right;">18612</td>
<td style="text-align: right;">25428</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00071</td>
<td style="text-align: right;">0.00069</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[5]</td>
<td style="text-align: right;">0.091</td>
<td style="text-align: right;">0.129</td>
<td style="text-align: left;">-0.111 .. 0.301</td>
<td style="text-align: right;">17653</td>
<td style="text-align: right;">22648</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00086</td>
<td style="text-align: right;">0.00080</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[6]</td>
<td style="text-align: right;">0.310</td>
<td style="text-align: right;">0.099</td>
<td style="text-align: left;">0.154 .. 0.469</td>
<td style="text-align: right;">19183</td>
<td style="text-align: right;">27703</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00060</td>
<td style="text-align: right;">0.00061</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[7]</td>
<td style="text-align: right;">0.179</td>
<td style="text-align: right;">0.083</td>
<td style="text-align: left;">0.0489 .. 0.312</td>
<td style="text-align: right;">17943</td>
<td style="text-align: right;">25101</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00052</td>
<td style="text-align: right;">0.00054</td>
</tr>
<tr class="odd">
<td class="rowLabel" style="text-align: left; font-weight: bold;">log_σ_stations[8]</td>
<td style="text-align: right;">0.385</td>
<td style="text-align: right;">0.131</td>
<td style="text-align: left;">0.179 .. 0.596</td>
<td style="text-align: right;">18154</td>
<td style="text-align: right;">24048</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00085</td>
<td style="text-align: right;">0.00082</td>
</tr>
<tr class="even">
<td class="rowLabel" style="text-align: left; font-weight: bold;">β_region</td>
<td style="text-align: right;">0.780</td>
<td style="text-align: right;">0.591</td>
<td style="text-align: left;">-0.164 .. 1.72</td>
<td style="text-align: right;">17773</td>
<td style="text-align: right;">16301</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.0046</td>
<td style="text-align: right;">0.0036</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>InferenceData<details>
<summary>posterior</summary>
<pre><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>×<span class="sgr38_5" style="color:#5fd7ff">8</span>×<span class="sgr38_5" style="color:#ff5f87">8</span> Dataset<span class="sgr90"> ┐</span>
<span class="sgr90">├────────────────────┴─────────────────────────────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ draw</span>, <span class="sgr38_5" style="color:#0087d7">→ chain</span>, <span class="sgr38_5" style="color:#5fd7ff">↗ α_μ_stations_dim_1</span>, <span class="sgr38_5" style="color:#ff5f87">⬔ log_σ_stations_dim_1</span>
<span class="sgr90">├────────────────────────────────────────────────────────────────────── layers ┤</span>
<span class="sgr38_5" style="color:#00afaf">  :ξ_region      </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :α_μ_stations  </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span>, <span class="sgr38_5" style="color:#5fd7ff">α_μ_stations_dim_1</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>×<span class="sgr38_5" style="color:#5fd7ff">8</span>
<span class="sgr38_5" style="color:#00afaf">  :log_σ_stations</span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span>, <span class="sgr38_5" style="color:#ff5f87">log_σ_stations_dim_1</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>×<span class="sgr38_5" style="color:#ff5f87">8</span>
<span class="sgr38_5" style="color:#00afaf">  :β_region      </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr90">├──────────────────────────────────────────────────────────────────── metadata ┤</span>
  Dict{String, Any} with 3 entries:
  &quot;created_at&quot; =&gt; &quot;2025-09-29T22:14:06.367&quot;
  &quot;inference_library_version&quot; =&gt; &quot;7.4.0&quot;
  &quot;inference_library&quot; =&gt; &quot;MCMCChains&quot;
</pre></details>
<details>
<summary>sample_stats</summary>
<pre><span class="sgr90">┌ </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span> Dataset<span class="sgr90"> ┐</span>
<span class="sgr90">├────────────────┴──────────────────────────────────────────── dims ┐</span>
  <span class="sgr38_5" style="color:#ff875f">↓ draw</span>, <span class="sgr38_5" style="color:#0087d7">→ chain</span>
<span class="sgr90">├─────────────────────────────────────────────────────────── layers ┤</span>
<span class="sgr38_5" style="color:#00afaf">  :energy          </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :n_steps         </span><span class="sgr90"> eltype: </span>Int64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :diverging       </span><span class="sgr90"> eltype: </span>Bool<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :max_energy_error</span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :loglikelihood   </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :energy_error    </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :is_accept       </span><span class="sgr90"> eltype: </span>Bool<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :logprior        </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :log_density     </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :tree_depth      </span><span class="sgr90"> eltype: </span>Int64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :step_size       </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :acceptance_rate </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :lp              </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr38_5" style="color:#00afaf">  :step_size_nom   </span><span class="sgr90"> eltype: </span>Float64<span class="sgr90"> dims: </span><span class="sgr38_5" style="color:#ff875f">draw</span>, <span class="sgr38_5" style="color:#0087d7">chain</span><span class="sgr90"> size: </span><span class="sgr38_5" style="color:#ff875f">6000</span>×<span class="sgr38_5" style="color:#0087d7">4</span>
<span class="sgr90">├───────────────────────────────────────────────────────── metadata ┤</span>
  Dict{String, Any} with 3 entries:
  &quot;created_at&quot; =&gt; &quot;2025-09-29T22:14:06.335&quot;
  &quot;inference_library_version&quot; =&gt; &quot;7.4.0&quot;
  &quot;inference_library&quot; =&gt; &quot;MCMCChains&quot;
</pre></details>
</div>
</div>
</div>
<div id="100" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb68"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Traceplots for regional parameters</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>regional_traceplots <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1200</span>, <span class="fl">400</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    param_names <span class="op">=</span> [<span class="op">:</span>β_region, <span class="op">:</span>ξ_region]</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, param) <span class="kw">in</span> <span class="fu">enumerate</span>(param_names)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> <span class="fu">Axis</span>(fig[i, <span class="fl">1</span>], xlabel<span class="op">=</span>i <span class="op">==</span> <span class="fu">length</span>(param_names) ? <span class="st">&quot;Iteration&quot;</span> <span class="op">:</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>            ylabel<span class="op">=</span><span class="fu">string</span>(param), title<span class="op">=</span>i <span class="op">==</span> <span class="fl">1</span> ? <span class="st">&quot;Regional Model Parameters&quot;</span> <span class="op">:</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">traceplot!</span>(ax, regional_idata, param)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-51-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="102" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb69"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">####lab 5- part 5</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>my_station_idx <span class="op">=</span> <span class="fu">findfirst</span>(x <span class="op">-&gt;</span> x <span class="op">==</span> my_stnid, analysis_stnids)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>regional_my_station <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract regional parameters (shared)</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    β_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>β_region]))</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    ξ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>ξ_region]))</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract station-specific parameters for our station</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    α_μ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>α_μ_stations])[<span class="op">:</span>, <span class="op">:</span>, my_station_idx])</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    σ_samples <span class="op">=</span> <span class="fu">exp</span>.(<span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>log_σ_stations])[<span class="op">:</span>, <span class="op">:</span>, my_station_idx]))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    (α_μ<span class="op">=</span>α_μ_samples, β_μ<span class="op">=</span>β_samples, σ<span class="op">=</span>σ_samples, ξ<span class="op">=</span>ξ_samples)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract single-station model results (Model 1: Location trend only)</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>single_station <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    model1_idata <span class="op">=</span> posterior_results[<span class="fl">1</span>].idata</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    α_μ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(model1_idata.posterior[<span class="op">:</span>α_μ]))</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    β_μ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(model1_idata.posterior[<span class="op">:</span>β_μ]))</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    σ_samples <span class="op">=</span> <span class="fu">exp</span>.(<span class="fu">vec</span>(<span class="fu">Array</span>(model1_idata.posterior[<span class="op">:</span>log_σ])))</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    ξ_samples <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(model1_idata.posterior[<span class="op">:</span>ξ]))</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    (α_μ<span class="op">=</span>α_μ_samples, β_μ<span class="op">=</span>β_μ_samples, σ<span class="op">=</span>σ_samples, ξ<span class="op">=</span>ξ_samples)</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for comparison plots</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>rts <span class="op">=</span> <span class="fu">logrange</span>(<span class="fl">1.1</span>, <span class="fl">250</span>, <span class="fl">100</span>)</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>xticks <span class="op">=</span> [<span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>]</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>x_2025 <span class="op">=</span> co2_data.log_CO2[co2_data.year<span class="op">.==</span><span class="fl">2024</span>][<span class="fl">1</span>]</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>x_centered <span class="op">=</span> x_2025 <span class="op">-</span> <span class="fu">log</span>(<span class="fl">380</span>)</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GEV distributions for 2025</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>μ_single_2025 <span class="op">=</span> single_station.α_μ <span class="op">.+</span> single_station.β_μ <span class="op">.*</span> x_centered</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>gevs_single <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>.(μ_single_2025, single_station.σ, single_station.ξ)</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>μ_regional_2025 <span class="op">=</span> regional_my_station.α_μ <span class="op">.+</span> regional_my_station.β_μ <span class="op">.*</span> x_centered</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>gevs_regional <span class="op">=</span> <span class="fu">GeneralizedExtremeValue</span>.(μ_regional_2025, regional_my_station.σ, regional_my_station.ξ)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>24000-element Vector{GeneralizedExtremeValue{Float64}}:
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.6336303125090375, σ=1.383674340751439, ξ=0.22064234152768586)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.632004659454368, σ=1.3978764437199858, ξ=0.2096795690969188)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.3633624258775647, σ=1.3260903928613736, ξ=0.24211210861454205)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.4776784519303305, σ=1.5669482848505178, ξ=0.20689000720868475)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.5889150103804326, σ=1.5397403203393565, ξ=0.21054913500005284)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.5942911380009486, σ=1.3370120330215278, ξ=0.2573430407909418)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.5603434744429014, σ=1.5669489547766917, ξ=0.23562572888919228)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.511831823725886, σ=1.5270058979144883, ξ=0.19377417467234206)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.3380636154984615, σ=1.3694443708393904, ξ=0.23152374773040776)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.565059806649753, σ=1.3161648865370252, ξ=0.2500931715506363)
 ⋮
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.6335322361996902, σ=1.4072365298036367, ξ=0.23979748888274596)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.5520931066478516, σ=1.45383547235274, ξ=0.22365479040836625)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.576824569470417, σ=1.445370957377166, ξ=0.19328974958264347)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.3799019965720474, σ=1.201241634974624, ξ=0.21062496320349813)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.749152775052, σ=1.5484195883652163, ξ=0.237031892306588)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.1993560229348135, σ=1.3473725376829535, ξ=0.2207084595248287)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.369640875390186, σ=1.6802111258370709, ξ=0.2256086135396791)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.604303896859855, σ=1.4770979629916237, ξ=0.23212398418287455)
 Distributions.GeneralizedExtremeValue{Float64}(μ=3.4399750184451756, σ=1.2952632485771045, ξ=0.2471979950019972)</code></pre>
</div>
</div>
<div id="104" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb71"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">####lab 5, part 5.1</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Return level curves comparison</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>return_level_fig <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">500</span>))</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Return Period (years)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Return Level (inches)&quot;</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;2025 Return Level Comparison: Single-Station vs Regional&quot;</span>,</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>        xscale<span class="op">=</span>log10, xticks<span class="op">=</span>xticks)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot uncertainty bands and mean curves</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax, gevs_single, rts; ci<span class="op">=</span><span class="fl">0.90</span>, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.3</span>))</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_mean_curve!</span>(ax, gevs_single, rts; color<span class="op">=:</span>blue, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">&quot;Single-Station&quot;</span>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_bands!</span>(ax, gevs_regional, rts; ci<span class="op">=</span><span class="fl">0.90</span>, color<span class="op">=</span>(<span class="op">:</span>red, <span class="fl">0.3</span>))</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">posterior_mean_curve!</span>(ax, gevs_regional, rts; color<span class="op">=:</span>red, linewidth<span class="op">=</span><span class="fl">3</span>, label<span class="op">=</span><span class="st">&quot;Regional&quot;</span>)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax, position<span class="op">=:</span>rb)</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-53-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="106" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb72"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lab 5-5.2, Parameter uncertainty comparison</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>parameter_uncertainty_fig <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">400</span>))</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;Parameter&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Posterior Standard Deviation&quot;</span>,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Parameter Uncertainty: Single-Station vs Regional&quot;</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> [L<span class="st">&quot;</span><span class="sc">$</span><span class="st">\</span>alpha_<span class="st">\mu</span><span class="sc">$</span><span class="st">&quot;, </span>L<span class="st">&quot;</span><span class="op">$\</span>beta_<span class="op">\</span>mu<span class="op">$</span><span class="st">&quot;, L&quot;</span><span class="op">$\</span>sigma<span class="op">$</span><span class="st">&quot;, L&quot;</span><span class="op">$\</span>xi<span class="op">$</span><span class="st">&quot;]</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    single_stds <span class="op">=</span> [</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">std</span>(single_station.α_μ),</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">std</span>(single_station.β_μ),</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">std</span>(single_station.σ),</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">std</span>(single_station.ξ),</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    regional_stds <span class="op">=</span> [</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">std</span>(regional_my_station.α_μ),</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">std</span>(regional_my_station.β_μ),</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">std</span>(regional_my_station.σ),</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">std</span>(regional_my_station.ξ),</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    x_pos <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(params)</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">barplot!</span>(ax, x_pos <span class="op">.-</span> <span class="fl">0.2</span>, single_stds, width<span class="op">=</span><span class="fl">0.35</span>, color<span class="op">=:</span>blue, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">&quot;Single-Station&quot;</span>)</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">barplot!</span>(ax, x_pos <span class="op">.+</span> <span class="fl">0.2</span>, regional_stds, width<span class="op">=</span><span class="fl">0.35</span>, color<span class="op">=:</span>red, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">&quot;Regional&quot;</span>)</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    ax.xticks <span class="op">=</span> (x_pos, params)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax, position<span class="op">=:</span>rt)</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-54-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="108" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb73"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># task 4, part e:Compare posterior uncertainty in 50-year return levels: single-station vs regional estimates for stations with different data lengths...50-year return level distributions</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>return_level_dist_fig <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">400</span>))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span><span class="st">&quot;50-year Return Level (inches)&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Density&quot;</span>,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;50-year Return Level Uncertainty&quot;</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate 100-year return levels</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    rl100_single <span class="op">=</span> [<span class="fu">quantile</span>(gev, <span class="fl">0.98</span>) for gev <span class="kw">in</span> gevs_single]<span class="co">###0.98 is for 1-1/T where T is 50</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    rl100_regional <span class="op">=</span> [<span class="fu">quantile</span>(gev, <span class="fl">0.98</span>) for gev <span class="kw">in</span> gevs_regional]</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax, rl100_single, bins<span class="op">=</span><span class="fl">30</span>, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.5</span>), label<span class="op">=</span><span class="st">&quot;Single-Station&quot;</span>, normalization<span class="op">=:</span>pdf)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax, rl100_regional, bins<span class="op">=</span><span class="fl">30</span>, color<span class="op">=</span>(<span class="op">:</span>red, <span class="fl">0.5</span>), label<span class="op">=</span><span class="st">&quot;Regional&quot;</span>, normalization<span class="op">=:</span>pdf)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax, position<span class="op">=:</span>rt)</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-55-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
<div id="110" class="cell" data-execution_count="1">
<div class="sourceCode" id="cb74"><pre class="sourceCode julia cell-code"><code class="sourceCode julia"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lB 5-5.4-Compare trend estimates from single-station vs regional models</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>trend_comparison_fig <span class="op">=</span> <span class="kw">let</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> <span class="fu">Figure</span>(size<span class="op">=</span>(<span class="fl">1000</span>, <span class="fl">400</span>))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Re-extract needed variables for proper scoping</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    single_idata <span class="op">=</span> posterior_results[<span class="fl">1</span>].idata</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    regional_fname <span class="op">=</span> <span class="fu">joinpath</span>(lab_dir, <span class="st">&quot;regional_nonstat.nc&quot;</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    regional_idata <span class="op">=</span> ArviZ.<span class="fu">from_netcdf</span>(regional_fname)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract trend parameters</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    single_β_μ <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(single_idata.posterior[<span class="op">:</span>β_μ]))</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    regional_β_μ <span class="op">=</span> <span class="fu">vec</span>(<span class="fu">Array</span>(regional_idata.posterior[<span class="op">:</span>β_region]))</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Left plot: trend parameter distributions</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">1</span>], xlabel<span class="op">=</span>L<span class="st">&quot;Location Trend Parameter </span><span class="sc">$</span><span class="st">\</span>beta_<span class="st">\mu$ (inches per log(ppm))&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Density&quot;</span>,</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Trend Parameter Estimates&quot;</span>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax1, single_β_μ, bins<span class="op">=</span><span class="fl">30</span>, color<span class="op">=</span>(<span class="op">:</span>blue, <span class="fl">0.5</span>), label<span class="op">=</span><span class="st">&quot;Single-Station&quot;</span>, normalization<span class="op">=:</span>pdf)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist!</span>(ax1, regional_β_μ, bins<span class="op">=</span><span class="fl">30</span>, color<span class="op">=</span>(<span class="op">:</span>red, <span class="fl">0.5</span>), label<span class="op">=</span><span class="st">&quot;Regional&quot;</span>, normalization<span class="op">=:</span>pdf)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axislegend</span>(ax1, position<span class="op">=:</span>rt)</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Right plot: uncertainty comparison</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> <span class="fu">Axis</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>], xlabel<span class="op">=</span><span class="st">&quot;Model&quot;</span>, ylabel<span class="op">=</span><span class="st">&quot;Standard Deviation&quot;</span>,</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">&quot;Trend Parameter Uncertainty&quot;</span>)</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>    trend_stds <span class="op">=</span> [<span class="fu">std</span>(single_β_μ), <span class="fu">std</span>(regional_β_μ)]</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">barplot!</span>(ax2, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, trend_stds, color<span class="op">=</span>[<span class="op">:</span>blue, <span class="op">:</span>red], alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>    ax2.xticks <span class="op">=</span> (<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, [<span class="st">&quot;Single-Station&quot;</span>, <span class="st">&quot;Regional&quot;</span>])</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add text labels on bars</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i, val) <span class="kw">in</span> <span class="fu">enumerate</span>(trend_stds)</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">text!</span>(ax2, i, val <span class="op">-</span> <span class="fl">0.25</span>, text<span class="op">=</span><span class="fu">string</span>(<span class="fu">round</span>(val, digits<span class="op">=</span><span class="fl">2</span>)),</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>            align<span class="op">=</span>(<span class="op">:</span>center, <span class="op">:</span>bottom), color<span class="op">=:</span>white, fontsize<span class="op">=</span><span class="fl">16</span>)</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>    fig</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>
<figure>
<p><img src="index_files/figure-html/cell-56-output-1.svg" class="img-fluid" /></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</div>
</div>
</section>
</section>
</div>
</div>
</section>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id = "quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->

</body>

</html>
